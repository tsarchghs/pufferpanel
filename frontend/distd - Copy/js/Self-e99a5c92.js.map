{"version":3,"file":"Self-e99a5c92.js","sources":["../../src/components/ui/OAuth.vue","../../src/views/Self.vue"],"sourcesContent":["<script setup>\nimport { ref, inject, onMounted } from 'vue'\nimport { useI18n } from 'vue-i18n'\nimport Btn from '@/components/ui/Btn.vue'\nimport Icon from '@/components/ui/Icon.vue'\nimport Overlay from '@/components/ui/Overlay.vue'\nimport TextField from '@/components/ui/TextField.vue'\n\nconst { t } = useI18n()\nconst api = inject('api')\nconst events = inject('events')\n\ndefineProps({\n  allowCreate: { type: Boolean, default: () => true },\n  allowDelete: { type: Boolean, default: () => true }\n})\n\nconst docsUrl = location.origin + '/swagger/index.html'\n\nconst clients = ref([])\nconst creating = ref(false)\nconst newName = ref('')\nconst newDescription = ref('')\nconst created = ref(false)\nconst createdData = ref(null)\n\nonMounted(() => {\n  refresh()\n})\n\nasync function refresh() {\n  clients.value = await api.self.getOAuthClients()\n}\n\nfunction startCreate() {\n  newName.value = ''\n  newDescription.value = ''\n  creating.value = true\n}\n\nasync function create() {\n  createdData.value = await api.self.createOAuthClient(newName.value, newDescription.value)\n\n  created.value = true\n  creating.value = false\n  refresh()\n}\n\nasync function deleteClient(clientId, clientName) {\n  events.emit(\n    'confirm',\n    t('oauth.ConfirmDelete', { name: clientName }),\n    {\n      text: t('oauth.Delete'),\n      icon: 'remove',\n      color: 'error',\n      action: async () => {\n        clients.value = await api.self.deleteOAuthClient(clientId)\n        refresh()\n      }\n    },\n    {\n      color: 'primary'\n    }\n  )\n}\n</script>\n\n<template>\n  <div class=\"oauth\">\n    <div class=\"info\">\n      <div v-text=\"t('oauth.AccountDescription')\" />\n      <div>\n        <a target=\"_blank\" :href=\"docsUrl\" v-text=\"t('oauth.Docs')\" />\n      </div>\n    </div>\n    <div v-for=\"(client, index) in clients\" :key=\"client.client_id\">\n      <div class=\"oauth-client\">\n        <div class=\"details\">\n          <div v-text=\"client.name || t('oauth.UnnamedClient')\" />\n          <div v-text=\"client.client_id\" />\n          <div :title=\"client.description\" v-text=\"client.description\" />\n        </div>\n        <btn v-if=\"allowDelete\" variant=\"icon\" @click=\"deleteClient(client.client_id, client.name || t('oauth.UnnamedClient'))\"><icon name=\"remove\" /></btn>\n      </div>\n      <hr v-if=\"index < clients.length - 1\" />\n    </div>\n    <btn v-if=\"allowCreate\" color=\"primary\" @click=\"startCreate()\"><icon name=\"plus\" />{{ t('oauth.Create') }}</btn>\n    <overlay v-model=\"creating\" :title=\"t('oauth.Create')\" closable>\n      <text-field v-model=\"newName\" autofocus :label=\"t('common.Name')\" />\n      <text-field v-model=\"newDescription\" :label=\"t('common.Description')\" />\n      <btn color=\"error\" @click=\"creating = false\"><icon name=\"close\" />{{ t('common.Cancel') }}</btn>\n      <btn color=\"primary\" @click=\"create()\"><icon name=\"save\" />{{ t('oauth.Create') }}</btn>\n    </overlay>\n    <overlay v-model=\"created\" :title=\"t('oauth.Credentials')\" closable>\n      <div class=\"warning\" v-text=\"t('oauth.NewClientWarning')\" />\n      <div class=\"client-id\">\n        <span class=\"name\" v-text=\"t('oauth.ClientId')+':'\" />\n        <span class=\"value\" v-text=\"createdData.client_id\" />\n      </div>\n      <div class=\"client-secret\">\n        <span class=\"name\" v-text=\"t('oauth.ClientSecret')+':'\" />\n        <span class=\"value\" v-text=\"createdData.client_secret\" />\n      </div>\n    </overlay>\n  </div>\n</template>\n","<script setup>\nimport { ref, inject, onMounted } from 'vue'\nimport { useI18n } from 'vue-i18n'\nimport { updateLocale, locales } from '@/plugins/i18n'\nimport Overlay from '@/components/ui/Overlay.vue'\nimport TextField from '@/components/ui/TextField.vue'\nimport Dropdown from '@/components/ui/Dropdown.vue'\nimport Btn from '@/components/ui/Btn.vue'\nimport Icon from '@/components/ui/Icon.vue'\nimport Loader from '@/components/ui/Loader.vue'\nimport OAuth from '@/components/ui/OAuth.vue'\nimport Tab from '@/components/ui/Tab.vue'\nimport Tabs from '@/components/ui/Tabs.vue'\nimport ThemeSetting from '@/components/ui/ThemeSetting.vue'\n\nconst { t, locale } = useI18n()\nconst api = inject('api')\nconst toast = inject('toast')\nconst themeApi = inject('theme')\nconst theme = ref(themeApi.getActiveTheme())\nconst themeSettings = ref({})\nconst user = ref(undefined)\nconst acc = ref(undefined)\nconst newPass = ref({ old: '', new: '', confirm: ''})\nconst otpEnabled = ref(false)\nconst otpEnrolling = ref(false)\nconst otpQrCode = ref(false)\nconst otpSecret = ref(false)\nconst otpDisabling = ref(false)\nconst token = ref('')\nconst selectedLocale = ref(locale.value)\n\nonMounted(async () => {\n  themeSettings.value = await themeApi.getThemeSettings()\n  const data = await api.self.get()\n  acc.value = { username: data.username, email: data.email, password: '' }\n  user.value = data\n  otpEnabled.value = await api.self.isOtpEnabled()\n})\n\nasync function themeChanged() {\n  themeSettings.value = await themeApi.getThemeSettings(theme.value)\n}\n\nfunction savePreferences() {\n  if (locale.value !== selectedLocale.value) {\n    updateLocale(selectedLocale.value)\n  }\n\n  const settings = {}\n  Object.keys(themeSettings.value).map(key => {\n    settings[key] = themeSettings.value[key].current\n  })\n\n  themeApi.setTheme(theme.value, settings)\n  toast.success(t('users.PreferencesUpdated'))\n}\n\nasync function startOtpEnroll() {\n  const data = await api.self.startOtpEnroll()\n  otpEnrolling.value = true\n  otpQrCode.value = data.img\n  otpSecret.value = data.secret\n}\n\nfunction resetOtpEnroll() {\n  otpEnrolling.value = false\n  otpQrCode.value = false\n  otpSecret.value = false\n  token.value = ''\n}\n\nasync function confirmOtpEnroll() {\n  await api.self.validateOtpEnroll(token.value)\n  resetOtpEnroll()\n  otpEnabled.value = await api.self.isOtpEnabled()\n  toast.success(t('users.UpdateSuccess'))\n}\n\nfunction startOtpDeactivation() {\n  otpDisabling.value = true\n}\n\nfunction resetOtpDeactivation() {\n  otpDisabling.value = false\n  token.value = ''\n}\n\nasync function confirmOtpDeactivation() {\n  await api.self.disableOtp(token.value)\n  resetOtpDeactivation()\n  otpEnabled.value = await api.self.isOtpEnabled()\n  toast.success(t('users.UpdateSuccess'))\n}\n\nfunction isValidUsername(u) {\n  return u.length >= 5\n}\n\nfunction isValidEmail(e) {\n  return e.match(/.+@.+\\..{2,}/)\n}\n\nfunction isValidPassword(p) {\n  return p.length >= 8\n}\n\nfunction canSubmitDetailsChange() {\n  return isValidUsername(acc.value.username) && isValidEmail(acc.value.email) && isValidPassword(acc.value.password)\n}\n\nfunction canSubmitPasswordChange() {\n  return isValidPassword(newPass.value.old) && isValidPassword(newPass.value.new) && newPass.value.new === newPass.value.confirm\n}\n\nasync function submitDetailsChange() {\n  if (!canSubmitDetailsChange()) return\n  await api.self.updateDetails(acc.value.username, acc.value.email, acc.value.password)\n  toast.success(t('users.InfoChanged'))\n}\n\nasync function submitPasswordChange() {\n  if (!canSubmitPasswordChange()) return\n  await api.self.changePassword(newPass.value.old, newPass.value.new)\n  toast.success(t('users.PasswordChanged'))\n}\n\nfunction updateThemeSetting(name, newSetting) {\n  themeSettings.value[name] = newSetting\n}\n</script>\n\n<template>\n  <div v-if=\"!user\" class=\"self loading\">\n    <div class=\"loader\"><loader /></div>\n  </div>\n  <div v-else class=\"self\">\n    <tabs anchors>\n      <tab id=\"preferences\" :title=\"t('users.Preferences')\" icon=\"settings\" hotkey=\"t s\">\n        <div class=\"preferences\">\n          <h1 v-text=\"t('users.Preferences')\" />\n          <dropdown v-model=\"selectedLocale\" class=\"locale-select\" :options=\"locales\" :label=\"t('common.Language')\" :hint=\"`[${t('common.HelpTranslate')}](https://translate.pufferpanel.com)`\">\n            <template #singlelabel=\"{ value }\">\n              <div class=\"multiselect-single-label\">\n                <span :data-locale=\"value.value\" /> {{ value.label }}\n              </div>\n            </template>\n\n            <template #option=\"{ option }\">\n              <span :data-locale=\"option.value\" /> {{ option.label }}\n            </template>\n          </dropdown>\n          <dropdown v-model=\"theme\" :options=\"$theme.getThemes()\" :label=\"t('common.theme.Theme')\" @change=\"themeChanged()\" />\n          <theme-setting v-for=\"(setting, name) in themeSettings\" :key=\"name\" :model-value=\"setting\" @update:modelValue=\"updateThemeSetting(name, $event)\" />\n          <btn color=\"primary\" @click=\"savePreferences()\"><icon name=\"save\" />{{ t('users.SavePreferences') }}</btn>\n        </div>\n      </tab>\n      <tab v-if=\"api.auth.hasScope('self.edit')\" id=\"account\" :title=\"t('users.ChangeInfo')\" icon=\"account\" hotkey=\"t a\">\n        <div class=\"accountdetails\">\n          <h1 v-text=\"t('users.ChangeInfo')\" />\n          <form>\n            <text-field v-model=\"acc.username\" icon=\"account\" :label=\"t('users.Username')\" />\n            <text-field v-model=\"acc.email\" icon=\"email\" type=\"email\" :label=\"t('users.Email')\" />\n            <text-field v-model=\"acc.password\" icon=\"lock\" type=\"password\" :label=\"t('users.ConfirmPassword')\" />\n            <btn :disabled=\"!canSubmitDetailsChange()\" color=\"primary\" @click=\"submitDetailsChange()\"><icon name=\"save\" />{{ t('users.ChangeInfo') }} </btn>\n          </form>\n        </div>\n      </tab>\n      <tab v-if=\"api.auth.hasScope('self.edit')\" id=\"changepassword\" :title=\"t('users.ChangePassword')\" icon=\"lock\" hotkey=\"t p\">\n        <div class=\"changepassword\">\n          <h1 v-text=\"t('users.ChangePassword')\" />\n          <form>\n            <text-field v-model=\"newPass.old\" icon=\"lock\" type=\"password\" :label=\"t('users.OldPassword')\" />\n            <text-field v-model=\"newPass.new\" icon=\"lock\" type=\"password\" :label=\"t('users.NewPassword')\" />\n            <text-field v-model=\"newPass.confirm\" icon=\"lock\" type=\"password\" :label=\"t('users.ConfirmPassword')\" />\n            <btn :disabled=\"!canSubmitPasswordChange()\" color=\"primary\" @click=\"submitPasswordChange()\"><icon name=\"save\" />{{ t('users.ChangePassword') }}</btn>\n          </form>\n        </div>\n      </tab>\n      <tab v-if=\"api.auth.hasScope('self.edit')\" id=\"otp\" :title=\"t('users.Otp')\" icon=\"2fa\" hotkey=\"t 2\">\n        <div class=\"mfa\">\n          <h1 v-text=\"t('users.Otp')\" />\n          <span class=\"description\">{{ t('users.OtpHint') }}</span>\n          <btn v-if=\"otpEnabled\" class=\"otp-toggle\" color=\"error\" @click=\"startOtpDeactivation()\"><icon name=\"lock-off\" />{{ t('users.OtpDisable') }}</btn>\n          <btn v-else class=\"otp-toggle\" color=\"primary\" @click=\"startOtpEnroll()\"><icon name=\"lock\" />{{ t('users.OtpEnable') }}</btn>\n          <overlay v-model=\"otpEnrolling\" class=\"otp-enroll\" :title=\"t('users.OtpEnable')\" closable @close=\"resetOtpEnroll()\">\n            <div class=\"otp-enroll-content\">\n              <div class=\"otp-enroll-qr\">\n                <img :src=\"otpQrCode\" />\n              </div>\n              <div class=\"otp-enroll-info\">\n                <h2 v-text=\"t('users.OtpSetupHint')\" />\n                <div><b class=\"otp-enroll-secret\" v-text=\"t('users.OtpSecret')\" /></div>\n                <span class=\"otp-enroll-secret\" v-text=\"otpSecret\" />\n                <h3 class=\"otp-enroll-confirm\" v-text=\"t('users.OtpConfirm')\" />\n                <text-field v-model=\"token\"/>\n              </div>\n            </div>\n            <div class=\"otp-enroll-actions\">\n              <btn color=\"error\" @click=\"resetOtpEnroll()\" v-text=\"t('common.Cancel')\" />\n              <btn color=\"primary\" @click=\"confirmOtpEnroll()\" v-text=\"t('users.OtpEnable')\" />\n            </div>\n          </overlay>\n          <overlay v-model=\"otpDisabling\" class=\"otp-deactivation\" :title=\"t('users.OtpDisable')\" closable @close=\"resetOtpDeactivation()\">\n            <div class=\"otp-deactivation-content\">\n              <text-field v-model=\"token\" :label=\"t('users.OtpConfirm')\" />\n            </div>\n            <div class=\"otp-deactivation-actions\">\n              <btn color=\"error\" @click=\"resetOtpDeactivation()\" v-text=\"t('common.Cancel')\" />\n              <btn color=\"primary\" @click=\"confirmOtpDeactivation()\" v-text=\"t('users.OtpDisable')\" />\n            </div>\n          </overlay>\n        </div>\n      </tab>\n      <tab v-if=\"api.auth.hasScope('self.clients')\" id=\"oauth\" :title=\"t('oauth.Clients')\" icon=\"api\" hotkey=\"t o\">\n        <div class=\"oauth\">\n          <h1 v-text=\"t('oauth.Clients')\" />\n          <o-auth />\n        </div>\n      </tab>\n    </tabs>\n  </div>\n</template>\n"],"names":[],"mappings":"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"}