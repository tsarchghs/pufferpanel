import{l as z,k as N,r as c,p as G,o as p,h as U,q as n,t as s,s as t,F as J,v as K,A as g,B as r,C as a,x as D,N as b}from"./vendor-943aface.js";import{e as x,a as C,_ as w,b as A,c as ue,l as ie,u as re}from"./index-b96ce60d.js";import{D as R}from"./Dropdown-f05f24bf.js";import{T as de,_ as j}from"./Tab-85f76cb0.js";import{_ as ce}from"./ThemeSetting-f50c637e.js";const me={class:"oauth"},ve={class:"info"},pe=["textContent"],fe=["textContent"],Ce={class:"oauth-client"},_e={class:"details"},he=["textContent"],be=["textContent"],we=["title","textContent"],Ve={key:0},ge=["textContent"],xe={class:"client-id"},ye=["textContent"],ke=["textContent"],$e={class:"client-secret"},Oe=["textContent"],Ue=["textContent"],De={props:{allowCreate:{type:Boolean,default:()=>!0},allowDelete:{type:Boolean,default:()=>!0}},setup(B){const{t:e}=z(),S=N("api"),f=N("events"),k=location.origin+"/swagger/index.html",V=c([]),h=c(!1),_=c(""),$=c(""),m=c(!1),v=c(null);G(()=>{y()});async function y(){V.value=await S.self.getOAuthClients()}function P(){_.value="",$.value="",h.value=!0}async function E(){v.value=await S.self.createOAuthClient(_.value,$.value),m.value=!0,h.value=!1,y()}async function T(O,u){f.emit("confirm",e("oauth.ConfirmDelete",{name:u}),{text:e("oauth.Delete"),icon:"remove",color:"error",action:async()=>{V.value=await S.self.deleteOAuthClient(O),y()}},{color:"primary"})}return(O,u)=>(p(),U("div",me,[n("div",ve,[n("div",{textContent:s(t(e)("oauth.AccountDescription"))},null,8,pe),n("div",null,[n("a",{target:"_blank",href:k,textContent:s(t(e)("oauth.Docs"))},null,8,fe)])]),(p(!0),U(J,null,K(V.value,(i,I)=>(p(),U("div",{key:i.client_id},[n("div",Ce,[n("div",_e,[n("div",{textContent:s(i.name||t(e)("oauth.UnnamedClient"))},null,8,he),n("div",{textContent:s(i.client_id)},null,8,be),n("div",{title:i.description,textContent:s(i.description)},null,8,we)]),B.allowDelete?(p(),g(C,{key:0,variant:"icon",onClick:F=>T(i.client_id,i.name||t(e)("oauth.UnnamedClient"))},{default:r(()=>[a(x,{name:"remove"})]),_:2},1032,["onClick"])):D("",!0)]),I<V.value.length-1?(p(),U("hr",Ve)):D("",!0)]))),128)),B.allowCreate?(p(),g(C,{key:0,color:"primary",onClick:u[0]||(u[0]=i=>P())},{default:r(()=>[a(x,{name:"plus"}),b(s(t(e)("oauth.Create")),1)]),_:1})):D("",!0),a(A,{modelValue:h.value,"onUpdate:modelValue":u[5]||(u[5]=i=>h.value=i),title:t(e)("oauth.Create"),closable:""},{default:r(()=>[a(w,{modelValue:_.value,"onUpdate:modelValue":u[1]||(u[1]=i=>_.value=i),autofocus:"",label:t(e)("common.Name")},null,8,["modelValue","label"]),a(w,{modelValue:$.value,"onUpdate:modelValue":u[2]||(u[2]=i=>$.value=i),label:t(e)("common.Description")},null,8,["modelValue","label"]),a(C,{color:"error",onClick:u[3]||(u[3]=i=>h.value=!1)},{default:r(()=>[a(x,{name:"close"}),b(s(t(e)("common.Cancel")),1)]),_:1}),a(C,{color:"primary",onClick:u[4]||(u[4]=i=>E())},{default:r(()=>[a(x,{name:"save"}),b(s(t(e)("oauth.Create")),1)]),_:1})]),_:1},8,["modelValue","title"]),a(A,{modelValue:m.value,"onUpdate:modelValue":u[6]||(u[6]=i=>m.value=i),title:t(e)("oauth.Credentials"),closable:""},{default:r(()=>[n("div",{class:"warning",textContent:s(t(e)("oauth.NewClientWarning"))},null,8,ge),n("div",xe,[n("span",{class:"name",textContent:s(t(e)("oauth.ClientId")+":")},null,8,ye),n("span",{class:"value",textContent:s(v.value.client_id)},null,8,ke)]),n("div",$e,[n("span",{class:"name",textContent:s(t(e)("oauth.ClientSecret")+":")},null,8,Oe),n("span",{class:"value",textContent:s(v.value.client_secret)},null,8,Ue)])]),_:1},8,["modelValue","title"])]))}},Se={key:0,class:"self loading"},Pe={class:"loader"},Ee={key:1,class:"self"},Te={class:"preferences"},Ne=["textContent"],je={class:"multiselect-single-label"},Ae=["data-locale"],Be=["data-locale"],Ie={class:"accountdetails"},Le=["textContent"],He={class:"changepassword"},qe=["textContent"],Fe={class:"mfa"},Me=["textContent"],Qe={class:"description"},We={class:"otp-enroll-content"},ze={class:"otp-enroll-qr"},Ge=["src"],Je={class:"otp-enroll-info"},Ke=["textContent"],Re=["textContent"],Xe=["textContent"],Ye=["textContent"],Ze={class:"otp-enroll-actions"},et={class:"otp-deactivation-content"},tt={class:"otp-deactivation-actions"},lt={class:"oauth"},nt=["textContent"],rt={setup(B){const{t:e,locale:S}=z(),f=N("api"),k=N("toast"),V=N("theme"),h=c(V.getActiveTheme()),_=c({}),$=c(void 0),m=c(void 0),v=c({old:"",new:"",confirm:""}),y=c(!1),P=c(!1),E=c(!1),T=c(!1),O=c(!1),u=c(""),i=c(S.value);G(async()=>{_.value=await V.getThemeSettings();const d=await f.self.get();m.value={username:d.username,email:d.email,password:""},$.value=d,y.value=await f.self.isOtpEnabled()});async function I(){_.value=await V.getThemeSettings(h.value)}function F(){S.value!==i.value&&re(i.value);const d={};Object.keys(_.value).map(l=>{d[l]=_.value[l].current}),V.setTheme(h.value,d),k.success(e("users.PreferencesUpdated"))}async function X(){const d=await f.self.startOtpEnroll();P.value=!0,E.value=d.img,T.value=d.secret}function L(){P.value=!1,E.value=!1,T.value=!1,u.value=""}async function Y(){await f.self.validateOtpEnroll(u.value),L(),y.value=await f.self.isOtpEnabled(),k.success(e("users.UpdateSuccess"))}function Z(){O.value=!0}function H(){O.value=!1,u.value=""}async function ee(){await f.self.disableOtp(u.value),H(),y.value=await f.self.isOtpEnabled(),k.success(e("users.UpdateSuccess"))}function te(d){return d.length>=5}function le(d){return d.match(/.+@.+\..{2,}/)}function q(d){return d.length>=8}function M(){return te(m.value.username)&&le(m.value.email)&&q(m.value.password)}function Q(){return q(v.value.old)&&q(v.value.new)&&v.value.new===v.value.confirm}async function ne(){!M()||(await f.self.updateDetails(m.value.username,m.value.email,m.value.password),k.success(e("users.InfoChanged")))}async function oe(){!Q()||(await f.self.changePassword(v.value.old,v.value.new),k.success(e("users.PasswordChanged")))}function ae(d,l){_.value[d]=l}return(d,l)=>$.value?(p(),U("div",Ee,[a(de,{anchors:""},{default:r(()=>[a(j,{id:"preferences",title:t(e)("users.Preferences"),icon:"settings",hotkey:"t s"},{default:r(()=>[n("div",Te,[n("h1",{textContent:s(t(e)("users.Preferences"))},null,8,Ne),a(R,{modelValue:i.value,"onUpdate:modelValue":l[0]||(l[0]=o=>i.value=o),class:"locale-select",options:t(ie),label:t(e)("common.Language"),hint:`[${t(e)("common.HelpTranslate")}](https://translate.pufferpanel.com)`},{singlelabel:r(({value:o})=>[n("div",je,[n("span",{"data-locale":o.value},null,8,Ae),b(" "+s(o.label),1)])]),option:r(({option:o})=>[n("span",{"data-locale":o.value},null,8,Be),b(" "+s(o.label),1)]),_:1},8,["modelValue","options","label","hint"]),a(R,{modelValue:h.value,"onUpdate:modelValue":l[1]||(l[1]=o=>h.value=o),options:d.$theme.getThemes(),label:t(e)("common.theme.Theme"),onChange:l[2]||(l[2]=o=>I())},null,8,["modelValue","options","label"]),(p(!0),U(J,null,K(_.value,(o,W)=>(p(),g(ce,{key:W,"model-value":o,"onUpdate:modelValue":se=>ae(W,se)},null,8,["model-value","onUpdate:modelValue"]))),128)),a(C,{color:"primary",onClick:l[3]||(l[3]=o=>F())},{default:r(()=>[a(x,{name:"save"}),b(s(t(e)("users.SavePreferences")),1)]),_:1})])]),_:1},8,["title"]),t(f).auth.hasScope("self.edit")?(p(),g(j,{key:0,id:"account",title:t(e)("users.ChangeInfo"),icon:"account",hotkey:"t a"},{default:r(()=>[n("div",Ie,[n("h1",{textContent:s(t(e)("users.ChangeInfo"))},null,8,Le),n("form",null,[a(w,{modelValue:m.value.username,"onUpdate:modelValue":l[4]||(l[4]=o=>m.value.username=o),icon:"account",label:t(e)("users.Username")},null,8,["modelValue","label"]),a(w,{modelValue:m.value.email,"onUpdate:modelValue":l[5]||(l[5]=o=>m.value.email=o),icon:"email",type:"email",label:t(e)("users.Email")},null,8,["modelValue","label"]),a(w,{modelValue:m.value.password,"onUpdate:modelValue":l[6]||(l[6]=o=>m.value.password=o),icon:"lock",type:"password",label:t(e)("users.ConfirmPassword")},null,8,["modelValue","label"]),a(C,{disabled:!M(),color:"primary",onClick:l[7]||(l[7]=o=>ne())},{default:r(()=>[a(x,{name:"save"}),b(s(t(e)("users.ChangeInfo")),1)]),_:1},8,["disabled"])])])]),_:1},8,["title"])):D("",!0),t(f).auth.hasScope("self.edit")?(p(),g(j,{key:1,id:"changepassword",title:t(e)("users.ChangePassword"),icon:"lock",hotkey:"t p"},{default:r(()=>[n("div",He,[n("h1",{textContent:s(t(e)("users.ChangePassword"))},null,8,qe),n("form",null,[a(w,{modelValue:v.value.old,"onUpdate:modelValue":l[8]||(l[8]=o=>v.value.old=o),icon:"lock",type:"password",label:t(e)("users.OldPassword")},null,8,["modelValue","label"]),a(w,{modelValue:v.value.new,"onUpdate:modelValue":l[9]||(l[9]=o=>v.value.new=o),icon:"lock",type:"password",label:t(e)("users.NewPassword")},null,8,["modelValue","label"]),a(w,{modelValue:v.value.confirm,"onUpdate:modelValue":l[10]||(l[10]=o=>v.value.confirm=o),icon:"lock",type:"password",label:t(e)("users.ConfirmPassword")},null,8,["modelValue","label"]),a(C,{disabled:!Q(),color:"primary",onClick:l[11]||(l[11]=o=>oe())},{default:r(()=>[a(x,{name:"save"}),b(s(t(e)("users.ChangePassword")),1)]),_:1},8,["disabled"])])])]),_:1},8,["title"])):D("",!0),t(f).auth.hasScope("self.edit")?(p(),g(j,{key:2,id:"otp",title:t(e)("users.Otp"),icon:"2fa",hotkey:"t 2"},{default:r(()=>[n("div",Fe,[n("h1",{textContent:s(t(e)("users.Otp"))},null,8,Me),n("span",Qe,s(t(e)("users.OtpHint")),1),y.value?(p(),g(C,{key:0,class:"otp-toggle",color:"error",onClick:l[12]||(l[12]=o=>Z())},{default:r(()=>[a(x,{name:"lock-off"}),b(s(t(e)("users.OtpDisable")),1)]),_:1})):(p(),g(C,{key:1,class:"otp-toggle",color:"primary",onClick:l[13]||(l[13]=o=>X())},{default:r(()=>[a(x,{name:"lock"}),b(s(t(e)("users.OtpEnable")),1)]),_:1})),a(A,{modelValue:P.value,"onUpdate:modelValue":l[17]||(l[17]=o=>P.value=o),class:"otp-enroll",title:t(e)("users.OtpEnable"),closable:"",onClose:l[18]||(l[18]=o=>L())},{default:r(()=>[n("div",We,[n("div",ze,[n("img",{src:E.value},null,8,Ge)]),n("div",Je,[n("h2",{textContent:s(t(e)("users.OtpSetupHint"))},null,8,Ke),n("div",null,[n("b",{class:"otp-enroll-secret",textContent:s(t(e)("users.OtpSecret"))},null,8,Re)]),n("span",{class:"otp-enroll-secret",textContent:s(T.value)},null,8,Xe),n("h3",{class:"otp-enroll-confirm",textContent:s(t(e)("users.OtpConfirm"))},null,8,Ye),a(w,{modelValue:u.value,"onUpdate:modelValue":l[14]||(l[14]=o=>u.value=o)},null,8,["modelValue"])])]),n("div",Ze,[a(C,{color:"error",onClick:l[15]||(l[15]=o=>L()),textContent:s(t(e)("common.Cancel"))},null,8,["textContent"]),a(C,{color:"primary",onClick:l[16]||(l[16]=o=>Y()),textContent:s(t(e)("users.OtpEnable"))},null,8,["textContent"])])]),_:1},8,["modelValue","title"]),a(A,{modelValue:O.value,"onUpdate:modelValue":l[22]||(l[22]=o=>O.value=o),class:"otp-deactivation",title:t(e)("users.OtpDisable"),closable:"",onClose:l[23]||(l[23]=o=>H())},{default:r(()=>[n("div",et,[a(w,{modelValue:u.value,"onUpdate:modelValue":l[19]||(l[19]=o=>u.value=o),label:t(e)("users.OtpConfirm")},null,8,["modelValue","label"])]),n("div",tt,[a(C,{color:"error",onClick:l[20]||(l[20]=o=>H()),textContent:s(t(e)("common.Cancel"))},null,8,["textContent"]),a(C,{color:"primary",onClick:l[21]||(l[21]=o=>ee()),textContent:s(t(e)("users.OtpDisable"))},null,8,["textContent"])])]),_:1},8,["modelValue","title"])])]),_:1},8,["title"])):D("",!0),t(f).auth.hasScope("self.clients")?(p(),g(j,{key:3,id:"oauth",title:t(e)("oauth.Clients"),icon:"api",hotkey:"t o"},{default:r(()=>[n("div",lt,[n("h1",{textContent:s(t(e)("oauth.Clients"))},null,8,nt),a(De)])]),_:1},8,["title"])):D("",!0)]),_:1})])):(p(),U("div",Se,[n("div",Pe,[a(ue)])]))}};export{rt as default};
//# sourceMappingURL=Self-e99a5c92.js.map
