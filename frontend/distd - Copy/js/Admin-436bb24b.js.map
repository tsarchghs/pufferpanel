{"version":3,"file":"Admin-436bb24b.js","sources":["../../src/components/template/ServerEnvironment.vue","../../src/components/server/Admin.vue"],"sourcesContent":["<script setup>\nimport { ref, onUpdated } from 'vue'\nimport { useI18n } from 'vue-i18n'\nimport EnvironmentConfig from '@/components/ui/EnvironmentConfig.vue'\n\nconst props = defineProps({\n  modelValue: { type: String, required: true }\n})\n\nconst emit = defineEmits(['update:modelValue'])\n\nconst { t } = useI18n()\nconst template = ref(JSON.parse(props.modelValue))\n\nfunction updateEnv(env, updated) {\n  const e = template.value.supportedEnvironments.find(e => e.type === env)\n  Object.keys(e).map(f => delete e[f])\n  Object.keys(updated).map(f => e[f] = updated[f])\n  emit('update:modelValue', JSON.stringify(template.value, undefined, 4))\n}\n\nonUpdated(() => {\n  try {\n    const u = JSON.parse(props.modelValue)\n    // reserializing to avoid issues due to formatting\n    if (JSON.stringify(template.value) !== JSON.stringify(u))\n      template.value = u\n  } catch {\n    // expected failure caused by json editor producing invalid json during modification\n  }\n})\n</script>\n\n<template>\n  <div class=\"environment\">\n    <environment-config :model-value=\"template.environment\" :no-fields-message=\"t('env.NoEnvFields')\" @update:modelValue=\"updateEnv(env, $event)\" />\n  </div>\n</template>\n","<script setup>\nimport { ref, inject, onMounted } from 'vue'\nimport { useRouter } from 'vue-router'\nimport { useI18n } from 'vue-i18n'\nimport Ace from '@/components/ui/Ace.vue'\nimport Btn from '@/components/ui/Btn.vue'\nimport Icon from '@/components/ui/Icon.vue'\nimport Overlay from '@/components/ui/Overlay.vue'\nimport Tab from '@/components/ui/Tab.vue'\nimport Tabs from '@/components/ui/Tabs.vue'\n\nimport Variables from '@/components/template/Variables.vue'\nimport Install from '@/components/template/Install.vue'\nimport Hooks from '@/components/template/Hooks.vue'\nimport RunConfig from '@/components/template/RunConfig.vue'\nimport ServerEnvironment from '@/components/template/ServerEnvironment.vue'\n\nconst { t } = useI18n()\nconst toast = inject('toast')\nconst events = inject('events')\nconst router = useRouter()\n\nconst props = defineProps({\n  server: { type: Object, required: true }\n})\n\nfunction editDefinition() {\n  edit.value = JSON.stringify(def.value, undefined, 4)\n  editorOpen.value = true\n}\n\nfunction cancelEdit() {\n  editorOpen.value = false\n}\n\nfunction saveDefinition() {\n  editorOpen.value = false\n  const edited = JSON.parse(edit.value)\n  props.server.updateDefinition(edited)\n  def.value = edited\n}\n\nfunction deleteServer() {\n  events.emit(\n    'confirm',\n    t('servers.ConfirmDelete', { name: props.server.name }),\n    {\n      text: t('servers.Delete'),\n      icon: 'remove',\n      color: 'error',\n      action: async () => {\n        await props.server.delete()\n        toast.success(t('servers.Deleted'))\n        // delay 500ms to prevent running into sqlite dbs still being locked\n        setTimeout(() => {router.push({ name: 'ServerList' })}, 500)\n      }\n    },\n    {\n      color: 'primary'\n    }\n  )\n}\n\nconst def = ref({})\nconst edit = ref(\"\")\nconst editorOpen = ref(false)\n\nonMounted(async () => {\n  if (props.server.hasScope('server.definition.view'))\n    def.value = await props.server.getDefinition()\n})\n</script>\n\n<template>\n  <div class=\"admin\">\n    <h2 v-text=\"t('servers.Admin')\" />\n    <btn v-if=\"server.hasScope('server.definition.view')\" v-hotkey=\"'a e'\" variant=\"text\" @click=\"editDefinition()\"><icon name=\"edit\" />{{ t('servers.EditDefinition') }}</btn>\n    <btn v-if=\"server.hasScope('server.delete')\" color=\"error\" @click=\"deleteServer()\"><icon name=\"remove\" />{{ t('servers.Delete') }}</btn>\n\n    <overlay v-model=\"editorOpen\" class=\"server-definition\">\n      <tabs>\n        <tab id=\"variables\" :title=\"t('templates.Variables')\" icon=\"variables\" hotkey=\"t v\">\n          <variables v-model=\"edit\" />\n        </tab>\n        <tab id=\"install\" :title=\"t('templates.Install')\" icon=\"install\" hotkey=\"t i\">\n          <install v-model=\"edit\" />\n        </tab>\n        <tab id=\"run\" :title=\"t('templates.RunConfig')\" icon=\"start\" hotkey=\"t r\">\n          <run-config v-model=\"edit\" />\n        </tab>\n        <tab id=\"hooks\" :title=\"t('templates.Hooks')\" icon=\"hooks\" hotkey=\"t h\">\n          <hooks v-model=\"edit\" />\n        </tab>\n        <tab id=\"environment\" :title=\"t('templates.Environment')\" icon=\"environment\" hotkey=\"t e\">\n          <div class=\"warning\" v-text=\"t('servers.EnvironmentEditHint')\" />\n          <server-environment v-model=\"edit\" />\n        </tab>\n        <tab id=\"json\" :title=\"t('templates.Json')\" icon=\"json\" hotkey=\"t j\">\n          <ace id=\"server-json\" v-model=\"edit\" class=\"server-json-editor\" mode=\"json\" />\n        </tab>\n      </tabs>\n      <div class=\"actions\">\n        <btn v-hotkey=\"'Escape'\" color=\"error\" @click=\"cancelEdit()\"><icon name=\"close\" />{{ t('common.Cancel') }}</btn>\n        <btn :disabled=\"!server.hasScope('server.definition.edit')\" color=\"primary\" @click=\"saveDefinition()\"><icon name=\"save\" />{{ t('common.Save') }}</btn>\n      </div>\n    </overlay>\n  </div>\n</template>\n"],"names":[],"mappings":"ioBAWM,CAAE,KAAM,IACR,EAAW,EAAI,KAAK,MAAM,EAAM,aAEtC,WAAmB,EAAK,EAAS,CAC/B,KAAM,GAAI,EAAS,MAAM,sBAAsB,KAAK,GAAK,EAAE,OAAS,GACpE,OAAO,KAAK,GAAG,IAAI,GAAK,MAAO,GAAE,IACjC,OAAO,KAAK,GAAS,IAAI,GAAK,EAAE,GAAK,EAAQ,IAC7C,EAAK,oBAAqB,KAAK,UAAU,EAAS,MAAO,OAAW,IAGtE,SAAU,IAAM,CACd,GAAI,CACF,KAAM,GAAI,KAAK,MAAM,EAAM,YAE3B,AAAI,KAAK,UAAU,EAAS,SAAW,KAAK,UAAU,IACpD,GAAS,MAAQ,QACnB,4VCVE,CAAE,KAAM,IACR,EAAQ,EAAO,SACf,EAAS,EAAO,UAChB,EAAS,IAMf,YAA0B,CACxB,EAAK,MAAQ,KAAK,UAAU,EAAI,MAAO,OAAW,GAClD,EAAW,MAAQ,GAGrB,YAAsB,CACpB,EAAW,MAAQ,GAGrB,YAA0B,CACxB,EAAW,MAAQ,GACnB,KAAM,GAAS,KAAK,MAAM,EAAK,OAC/B,EAAM,OAAO,iBAAiB,GAC9B,EAAI,MAAQ,EAGd,YAAwB,CACtB,EAAO,KACL,UACA,EAAE,wBAAyB,CAAE,KAAM,EAAM,OAAO,OAChD,CACE,KAAM,EAAE,kBACR,KAAM,SACN,MAAO,QACP,OAAQ,SAAY,CAClB,KAAM,GAAM,OAAO,SACnB,EAAM,QAAQ,EAAE,oBAEhB,WAAW,IAAM,CAAC,EAAO,KAAK,CAAE,KAAM,gBAAkB,OAG5D,CACE,MAAO,YAKb,KAAM,GAAM,EAAI,IACV,EAAO,EAAI,IACX,EAAa,EAAI,IAEvB,SAAU,SAAY,CACpB,AAAI,EAAM,OAAO,SAAS,2BACxB,GAAI,MAAQ,KAAM,GAAM,OAAO"}