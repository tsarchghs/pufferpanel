{"version":3,"file":"TemplateCreate-6576ea25.js","sources":["../../src/views/TemplateCreate.vue"],"sourcesContent":["<script setup>\nimport { ref, inject, onMounted } from 'vue'\nimport { useRoute, useRouter, onBeforeRouteLeave } from 'vue-router'\nimport { useI18n } from 'vue-i18n'\n\nimport General from '@/components/template/General.vue'\nimport Variables from '@/components/template/Variables.vue'\nimport Install from '@/components/template/Install.vue'\nimport Hooks from '@/components/template/Hooks.vue'\nimport RunConfig from '@/components/template/RunConfig.vue'\nimport Environment from '@/components/template/Environment.vue'\n\nimport Ace from '@/components/ui/Ace.vue'\nimport Btn from '@/components/ui/Btn.vue'\nimport Icon from '@/components/ui/Icon.vue'\nimport Tabs from '@/components/ui/Tabs.vue'\nimport Tab from '@/components/ui/Tab.vue'\n\nconst api = inject('api')\nconst toast = inject('toast')\nconst events = inject('events')\nconst { t } = useI18n()\nconst route = useRoute()\nconst router = useRouter()\n\nlet unmodified = `{\n    \"name\": \"\",\n    \"display\": \"\",\n    \"type\": \"\",\n    \"data\": {},\n    \"groups\": [],\n    \"install\": [],\n    \"run\": {\n        \"command\": \"\",\n        \"stop\": \"\",\n        \"workingDirectory\": \"\",\n        \"pre\": [],\n        \"post\": [],\n        \"environmentVars\": {}\n    },\n    \"environment\": {\n        \"type\": \"host\"\n    },\n    \"supportedEnvironments\": [\n      { \"type\": \"host\" }\n    ]\n}`\nconst template = ref(unmodified)\nconst valid = ref({\n  general: false,\n  run: false\n})\nlet saved = false\n\nonBeforeRouteLeave(() => {\n  if (saved || (unmodified === template.value)) {\n    return true\n  } else {\n    return new Promise((resolve) => {\n      events.emit(\n        'confirm',\n        t('common.ConfirmLeave'),\n        {\n          text: t('common.Discard'),\n          icon: 'remove',\n          color: 'error',\n          action: () => { resolve(true) }\n        },\n        {\n          color: 'primary',\n          action: () => { resolve(false) }\n        }\n      )\n    })\n  }\n})\n\nonMounted(() => {\n  if (route.query.copy) {\n    const t = sessionStorage.getItem('copiedTemplate')\n    if (t) {\n      template.value = t\n      sessionStorage.removeItem('copiedTemplate')\n      setTimeout(() => {\n        unmodified = template.value\n      }, 50)\n    }\n  }\n})\n\nasync function save() {\n  if (!canSave()) return\n  const name = JSON.parse(template.value).name\n\n  const exists = await api.template.exists(0, name)\n  const doSave = async () => {\n    await api.template.save(name, template.value)\n    toast.success(t('templates.Saved'))\n    saved = true\n    router.push({ name: 'TemplateView', params: { repo: 0, id: name } })\n  }\n  if (!exists) {\n    doSave()\n  } else {\n    events.emit(\n      'confirm',\n      t('templates.ConfirmOverwrite'),\n      {\n        text: t('templates.Overwrite'),\n        icon: 'check',\n        action: () => {\n          doSave()\n        }\n      }\n    )\n  }\n}\n\nfunction canSave() {\n  return Object.values(valid.value).filter(e => e === false).length === 0\n}\n</script>\n\n<template>\n  <div class=\"templatecreate\">\n    <div>\n      <tabs anchors>\n        <tab id=\"general\" :title=\"t('templates.General')\" icon=\"general\" hotkey=\"t g\">\n          <general v-model=\"template\" id-editable @valid=\"valid.general = $event\" />\n        </tab>\n        <tab id=\"variables\" :title=\"t('templates.Variables')\" icon=\"variables\" hotkey=\"t v\">\n          <variables v-model=\"template\" />\n        </tab>\n        <tab id=\"install\" :title=\"t('templates.Install')\" icon=\"install\" hotkey=\"t i\">\n          <install v-model=\"template\" />\n        </tab>\n        <tab id=\"run\" :title=\"t('templates.RunConfig')\" icon=\"start\" hotkey=\"t r\">\n          <run-config v-model=\"template\" @valid=\"valid.run = $event\" />\n        </tab>\n        <tab id=\"hooks\" :title=\"t('templates.Hooks')\" icon=\"hooks\" hotkey=\"t h\">\n          <hooks v-model=\"template\" />\n        </tab>\n        <tab id=\"environment\" :title=\"t('templates.Environment')\" icon=\"environment\" hotkey=\"t e\">\n          <environment v-model=\"template\" />\n        </tab>\n        <tab id=\"json\" :title=\"t('templates.Json')\" icon=\"json\" hotkey=\"t j\">\n          <ace id=\"template-json\" v-model=\"template\" class=\"template-json-editor\" mode=\"json\" />\n        </tab>\n      </tabs>\n      <btn color=\"primary\" :disabled=\"!canSave()\" @click=\"save()\"><icon name=\"save\" />{{ t('common.Save') }}</btn>\n    </div>\n  </div>\n</template>\n"],"names":[],"mappings":"qjBAkBA,KAAM,GAAM,EAAO,OACb,EAAQ,EAAO,SACf,EAAS,EAAO,UAChB,CAAE,KAAM,IACR,EAAQ,IACR,EAAS,IAEf,GAAI,GAAa;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAsBjB,KAAM,GAAW,EAAI,GACf,EAAQ,EAAI,CAChB,QAAS,GACT,IAAK,KAEP,GAAI,GAAQ,GAEZ,EAAmB,IACb,GAAU,IAAe,EAAS,MAC7B,GAEA,GAAI,SAAQ,AAAC,GAAY,CAC9B,EAAO,KACL,UACA,EAAE,uBACF,CACE,KAAM,EAAE,kBACR,KAAM,SACN,MAAO,QACP,OAAQ,IAAM,CAAE,EAAQ,MAE1B,CACE,MAAO,UACP,OAAQ,IAAM,CAAE,EAAQ,UAOlC,EAAU,IAAM,CACd,GAAI,EAAM,MAAM,KAAM,CACpB,KAAM,GAAI,eAAe,QAAQ,kBACjC,AAAI,GACF,GAAS,MAAQ,EACjB,eAAe,WAAW,kBAC1B,WAAW,IAAM,CACf,EAAa,EAAS,OACrB,QAKT,kBAAsB,CACpB,GAAI,CAAC,IAAW,OAChB,KAAM,GAAO,KAAK,MAAM,EAAS,OAAO,KAElC,EAAS,KAAM,GAAI,SAAS,OAAO,EAAG,GACtC,EAAS,SAAY,CACzB,KAAM,GAAI,SAAS,KAAK,EAAM,EAAS,OACvC,EAAM,QAAQ,EAAE,oBAChB,EAAQ,GACR,EAAO,KAAK,CAAE,KAAM,eAAgB,OAAQ,CAAE,KAAM,EAAG,GAAI,MAE7D,AAAK,EAGH,EAAO,KACL,UACA,EAAE,8BACF,CACE,KAAM,EAAE,uBACR,KAAM,QACN,OAAQ,IAAM,CACZ,OATN,IAgBJ,YAAmB,CACjB,MAAO,QAAO,OAAO,EAAM,OAAO,OAAO,GAAK,IAAM,IAAO,SAAW"}