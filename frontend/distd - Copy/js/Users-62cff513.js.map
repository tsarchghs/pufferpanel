{"version":3,"file":"Users-62cff513.js","sources":["../../src/components/server/Users.vue"],"sourcesContent":["<script setup>\nimport { ref, inject, onMounted } from 'vue'\nimport { useI18n } from 'vue-i18n'\nimport Btn from '@/components/ui/Btn.vue'\nimport Icon from '@/components/ui/Icon.vue'\nimport TextField from '@/components/ui/TextField.vue'\nimport Toggle from '@/components/ui/Toggle.vue'\n\nconst { t, te, locale } = useI18n()\nconst toast = inject('toast')\n\nconst users = ref([])\nconst newEmail = ref('')\n\nconst perms = [\n  'server.view',\n\t'server.admin',\n\t'server.delete',\n\t'server.definition.view',\n\t'server.definition.edit',\n\t'server.data.view',\n\t'server.data.edit',\n  'server.data.edit.admin',\n\t'server.flags.view',\n\t'server.flags.edit',\n\t'server.name.edit',\n\t'server.users.view',\n\t'server.users.create',\n\t'server.users.edit',\n\t'server.users.delete',\n\t//'server.tasks.view',\n\t//'server.tasks.run',\n\t//'server.tasks.create',\n\t//'server.tasks.delete',\n\t//'server.tasks.edit',\n\t'server.start',\n\t'server.stop',\n\t'server.kill',\n\t'server.install',\n\t'server.files.view',\n\t'server.files.edit',\n\t'server.sftp',\n\t'server.console',\n\t'server.console.send',\n\t'server.stats',\n\t'server.status'\n].map(scope => {\n  const res = {\n    label: t('scopes.name.' + scope.replace(/\\./g, '-')),\n    name: scope\n  }\n  if (te('scopes.hint.' + scope.replace(/\\./g, '-'), locale))\n    res.hint = t('scopes.hint.' + scope.replace(/\\./g, '-'))\n  return res\n})\n\nconst props = defineProps({\n  server: { type: Object, required: true }\n})\n\nasync function sendInvite() {\n  const newUser = { email: newEmail.value }\n  await props.server.updateUser(newUser)\n  toast.success(t('users.UserInvited'))\n  loadUsers()\n}\n\nasync function updatePerms(user) {\n  const scopes = Object.keys(user.scopes).filter(p => user.scopes[p])\n  const update = { ...user, scopes }\n  await props.server.updateUser(update)\n  toast.success(t('users.UpdateSuccess'))\n}\n\nasync function deleteUser(user) {\n  await props.server.deleteUser(user.email)\n  loadUsers()\n}\n\nasync function loadUsers() {\n  const u = await props.server.getUsers()\n  users.value = u.map(user => {\n    const scopes = {}\n    perms.map(p => {\n      scopes[p.name] = user.scopes.indexOf(p.name) > -1\n    })\n    user.scopes = scopes\n    return user\n  })\n}\n\nfunction permissionDisabled(scope) {\n  // always deny changing any permission if user doesn't have edit user permission\n  if (!props.server.hasScope('server.users.edit')) return true\n\n  // only allow changing any permission the current user posseses themselves\n  return !props.server.hasScope(scope)\n}\n\nonMounted(async () => {\n  loadUsers()\n})\n</script>\n\n<template>\n  <div>\n    <h2 v-text=\"t('users.Users')\" />\n    <div v-for=\"user in users\" :key=\"user.email\" :class=\"['user', user.open ? 'open' : 'closed']\">\n      <h3 @click=\"user.open = !user.open\" v-text=\"user.username\" />\n      <toggle\n        v-for=\"perm in perms\"\n        :key=\"perm.name\"\n        v-model=\"user.scopes[perm.name]\"\n        :disabled=\"permissionDisabled(perm.name)\"\n        :label=\"perm.label\"\n        :hint=\"perm.hint\"\n        @update:modelValue=\"updatePerms(user)\"\n      />\n      <btn v-if=\"server.hasScope('server.users.delete')\" color=\"error\" @click=\"deleteUser(user)\" v-text=\"t('users.Delete')\" />\n    </div>\n    <div v-if=\"users.length === 0\" class=\"no-users\" v-text=\"t('servers.NoUsers')\" />\n    <div v-if=\"server.hasScope('server.users.create')\" class=\"invite\">\n      <text-field v-model=\"newEmail\" type=\"email\" icon=\"email\" :label=\"t('users.Email')\" />\n      <btn color=\"primary\" @click=\"sendInvite()\"><icon name=\"plus\" />{{ t('servers.InviteUser') }}</btn>\n    </div>\n  </div>\n</template>\n"],"names":[],"mappings":"o0BAQM,CAAE,IAAG,KAAI,UAAW,IACpB,EAAQ,EAAO,SAEf,EAAQ,EAAI,IACZ,EAAW,EAAI,IAEf,EAAQ,CACZ,cACD,eACA,gBACA,yBACA,yBACA,mBACA,mBACC,yBACD,oBACA,oBACA,mBACA,oBACA,sBACA,oBACA,sBAMA,eACA,cACA,cACA,iBACA,oBACA,oBACA,cACA,iBACA,sBACA,eACA,iBACC,IAAI,GAAS,CACb,KAAM,GAAM,CACV,MAAO,EAAE,eAAiB,EAAM,QAAQ,MAAO,MAC/C,KAAM,GAER,MAAI,GAAG,eAAiB,EAAM,QAAQ,MAAO,KAAM,IACjD,GAAI,KAAO,EAAE,eAAiB,EAAM,QAAQ,MAAO,OAC9C,IAOT,kBAA4B,CAC1B,KAAM,GAAU,CAAE,MAAO,EAAS,OAClC,KAAM,GAAM,OAAO,WAAW,GAC9B,EAAM,QAAQ,EAAE,sBAChB,IAGF,iBAA2B,EAAM,CAC/B,KAAM,GAAS,OAAO,KAAK,EAAK,QAAQ,OAAO,GAAK,EAAK,OAAO,IAC1D,EAAS,OAAK,GAAL,CAAW,WAC1B,KAAM,GAAM,OAAO,WAAW,GAC9B,EAAM,QAAQ,EAAE,wBAGlB,iBAA0B,EAAM,CAC9B,KAAM,GAAM,OAAO,WAAW,EAAK,OACnC,IAGF,kBAA2B,CACzB,KAAM,GAAI,KAAM,GAAM,OAAO,WAC7B,EAAM,MAAQ,EAAE,IAAI,GAAQ,CAC1B,KAAM,GAAS,GACf,SAAM,IAAI,GAAK,CACb,EAAO,EAAE,MAAQ,EAAK,OAAO,QAAQ,EAAE,MAAQ,KAEjD,EAAK,OAAS,EACP,IAIX,WAA4B,EAAO,CAEjC,MAAK,GAAM,OAAO,SAAS,qBAGpB,CAAC,EAAM,OAAO,SAAS,GAH0B,GAM1D,SAAU,SAAY,CACpB"}