{"version":3,"file":"UserList-c5804e0e.js","sources":["../../src/views/UserList.vue"],"sourcesContent":["<script setup>\nimport { ref, inject, onMounted, onUnmounted, nextTick } from 'vue'\nimport { RouterLink } from 'vue-router'\nimport { useI18n } from 'vue-i18n'\nimport md5 from 'js-md5'\nimport Icon from '@/components/ui/Icon.vue'\nimport Loader from '@/components/ui/Loader.vue'\n\nconst api = inject('api')\nconst { t } = useI18n()\n\nconst users = ref([])\nlet lastPage = 0\nlet loadingPage = false\nconst allUsersLoaded = ref(false)\nconst loaderRef = ref(null)\nconst firstEntry = ref(null)\n\nfunction addUsers(newUsers) {\n  newUsers.map(user => users.value.push(user))\n}\n\nfunction isLoaderVisible() {\n  if (!loaderRef.value) return false\n  const vw = window.innerWidth || document.documentElement.clientWidth\n  const vh = window.innerHeight || document.documentElement.clientHeight\n  const rect = loaderRef.value.$el.getBoundingClientRect()\n  return rect.top >= 0 && rect.left >= 0 && rect.bottom <= vh && rect.right <= vw\n}\n\nasync function loadPage(page = 1) {\n  loadingPage = true\n  const data = await api.user.list(page)\n  addUsers(data.users)\n  lastPage = data.paging.page\n  allUsersLoaded.value = data.paging.page * data.paging.pageSize >= (data.paging.total || 0)\n  nextTick(() => {\n    loadingPage = false\n    if (!allUsersLoaded.value && isLoaderVisible()) loadPage(lastPage + 1)\n  })\n}\n\nfunction onScroll() {\n  if (!loadingPage && isLoaderVisible()) loadPage(lastPage + 1)\n}\n\nonMounted(() => {\n  nextTick(() => {\n    loadPage()\n    window.addEventListener('scroll', onScroll)\n  })\n})\n\nonUnmounted(() => {\n  window.removeEventListener('scroll', onScroll)\n})\n\nfunction setFirstEntry(ref) {\n  if (!firstEntry.value) firstEntry.value = ref\n}\n\nfunction focusList() {\n  firstEntry.value.$el.focus()\n}\n</script>\n\n<template>\n  <div class=\"userlist\">\n    <h1 v-text=\"t('users.Users')\" />\n    <div v-hotkey=\"'l'\" class=\"list\" @hotkey=\"focusList()\">\n      <div v-for=\"user in users\" :key=\"user.id\" class=\"list-item\">\n        <router-link :ref=\"setFirstEntry\" :to=\"{ name: 'UserView', params: { id: user.id } }\">\n          <div class=\"user\">\n            <img :src=\"'https://www.gravatar.com/avatar/' + md5(user.email) + '?d=mp'\" class=\"avatar\" />\n            <div>\n              <span class=\"title\">{{user.username}}</span>\n              <span class=\"subline\">{{user.email}}</span>\n            </div>\n          </div>\n        </router-link>\n      </div>\n      <div v-if=\"!allUsersLoaded\" ref=\"loaderRef\" class=\"list-item\">\n        <loader small />\n      </div>\n      <div v-if=\"$api.auth.hasScope('users.info.edit')\" class=\"list-item\">\n        <router-link v-hotkey=\"'c'\" :to=\"{ name: 'UserCreate' }\">\n          <div class=\"createLink\"><icon name=\"plus\" />{{ t('users.Add') }}</div>\n        </router-link>\n      </div>\n    </div>\n  </div>\n</template>\n"],"names":[],"mappings":"kYAQA,KAAM,GAAM,EAAO,OACb,CAAE,KAAM,IAER,EAAQ,EAAI,IAClB,GAAI,GAAW,EACX,EAAc,GAClB,KAAM,GAAiB,EAAI,IACrB,EAAY,EAAI,MAChB,EAAa,EAAI,MAEvB,WAAkB,EAAU,CAC1B,EAAS,IAAI,GAAQ,EAAM,MAAM,KAAK,IAGxC,YAA2B,CACzB,GAAI,CAAC,EAAU,MAAO,MAAO,GAC7B,KAAM,GAAK,OAAO,YAAc,SAAS,gBAAgB,YACnD,EAAK,OAAO,aAAe,SAAS,gBAAgB,aACpD,EAAO,EAAU,MAAM,IAAI,wBACjC,MAAO,GAAK,KAAO,GAAK,EAAK,MAAQ,GAAK,EAAK,QAAU,GAAM,EAAK,OAAS,EAG/E,iBAAwB,EAAO,EAAG,CAChC,EAAc,GACd,KAAM,GAAO,KAAM,GAAI,KAAK,KAAK,GACjC,EAAS,EAAK,OACd,EAAW,EAAK,OAAO,KACvB,EAAe,MAAQ,EAAK,OAAO,KAAO,EAAK,OAAO,UAAa,GAAK,OAAO,OAAS,GACxF,EAAS,IAAM,CACb,EAAc,GACV,CAAC,EAAe,OAAS,KAAmB,EAAS,EAAW,KAIxE,YAAoB,CAClB,AAAI,CAAC,GAAe,KAAmB,EAAS,EAAW,GAG7D,EAAU,IAAM,CACd,EAAS,IAAM,CACb,IACA,OAAO,iBAAiB,SAAU,OAItC,EAAY,IAAM,CAChB,OAAO,oBAAoB,SAAU,KAGvC,WAAuB,EAAK,CAC1B,AAAK,EAAW,OAAO,GAAW,MAAQ,GAG5C,YAAqB,CACnB,EAAW,MAAM,IAAI"}