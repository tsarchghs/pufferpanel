import{l as K,m as Q,H as W,k as g,r as d,p as X,o as n,h as f,q as $,t as b,s as t,C as w,A as y,x as m,B as k,P as Y,F as _,v as H,N as V}from"./vendor-943aface.js";import{_ as U,a as C,e as D}from"./index-b96ce60d.js";import{_ as Z}from"./Toggle-edd22afa.js";const ee={class:"userview"},se={key:0,class:"details"},ae=["textContent"],re={key:1,class:"permissions"},te=["textContent"],ne=["textContent"],me={setup(oe){const{t:a,te:I,locale:L}=K(),h=Q(),O=W(),o=g("api"),S=g("toast"),p=g("validate"),R=g("events"),i=d(""),v=d(""),u=d(""),x=d(""),P=d(""),B=d("");function E(){return p.username(i.value)&&p.email(v.value)&&(p.password(u.value)||u.value.length===0)}async function N(){await o.user.update(h.params.id,{username:i.value,email:v.value,password:u.value||void 0}),S.success(a("users.UpdateSuccess"))}async function T(){if(!E())return!1;await o.user.updatePermissions(h.params.id,{scopes:l.value}),S.success(a("users.UpdateSuccess"))}async function q(){R.emit("confirm",a("users.ConfirmDelete",{name:i.value}),{text:a("users.Delete"),icon:"remove",color:"error",action:async()=>{await o.user.delete(h.params.id),S.success(a("users.DeleteSuccess")),O.push({name:"UserList"})}},{color:"primary"})}const F={general:["admin","login","self.edit","self.clients","settings.edit"],servers:["server.create"],nodes:["nodes.view","nodes.create","nodes.edit","nodes.deploy","nodes.delete"],users:["users.info.search","users.info.view","users.info.edit","users.perms.view","users.perms.edit"],templates:["templates.view","templates.local.edit","templates.repo.view","templates.repo.add","templates.repo.remove"]},l=d([]);X(async()=>{const e=await o.user.get(h.params.id);i.value=e.username,v.value=e.email,l.value=await o.user.getPermissions(h.params.id)});function M(e){return a("scopes.name."+e.replace(/\./g,"-"))}function A(e){if(I("scopes.hint."+e.replace(/\./g,"-"),L))return a("scopes.hint."+e.replace(/\./g,"-"))}function z(e){return a({servers:"servers.Servers",nodes:"nodes.Nodes",users:"users.Users",templates:"templates.Templates"}[e])}function G(e){return o.auth.hasScope("user.perms.edit")?e==="admin"&&o.auth.hasScope("admin")?!1:e==="admin"||l.value.indexOf("admin")>=0?!0:!o.auth.hasScope(e):!0}function J(e){l.value.indexOf(e)===-1?l.value=[...l.value,e]:l.value=l.value.filter(s=>s!==e)}return(e,s)=>(n(),f("div",ee,[e.$api.auth.hasScope("users.info.view")?(n(),f("div",se,[$("h1",{textContent:b(t(a)("users.Details"))},null,8,ae),$("form",{onSubmit:s[8]||(s[8]=Y(r=>N(),["prevent"]))},[w(U,{modelValue:i.value,"onUpdate:modelValue":s[0]||(s[0]=r=>i.value=r),label:t(a)("users.Username"),icon:"account",error:x.value,disabled:!e.$api.auth.hasScope("users.info.edit"),onBlur:s[1]||(s[1]=r=>x.value=t(p).username(i.value)?"":t(a)("errors.ErrUsernameRequirements"))},null,8,["modelValue","label","error","disabled"]),w(U,{modelValue:v.value,"onUpdate:modelValue":s[2]||(s[2]=r=>v.value=r),label:t(a)("users.Email"),type:"email",icon:"email",error:P.value,disabled:!e.$api.auth.hasScope("users.info.edit"),onBlur:s[3]||(s[3]=r=>P.value=t(p).email(v.value)?"":t(a)("errors.ErrEmailInvalid"))},null,8,["modelValue","label","error","disabled"]),e.$api.auth.hasScope("users.info.edit")?(n(),y(U,{key:0,modelValue:u.value,"onUpdate:modelValue":s[4]||(s[4]=r=>u.value=r),label:t(a)("users.Password"),type:"password",icon:"lock",error:B.value,onBlur:s[5]||(s[5]=r=>B.value=t(p).password(u.value)||u.value.length===0?"":t(a)("error.PasswordInvalid"))},null,8,["modelValue","label","error"])):m("",!0),e.$api.auth.hasScope("users.info.edit")?(n(),y(C,{key:1,color:"primary",disabled:!E(),onClick:s[6]||(s[6]=r=>N())},{default:k(()=>[w(D,{name:"save"}),V(b(t(a)("users.UpdateDetails")),1)]),_:1},8,["disabled"])):m("",!0),e.$api.auth.hasScope("users.info.edit")?(n(),y(C,{key:2,color:"error",onClick:s[7]||(s[7]=r=>q())},{default:k(()=>[w(D,{name:"remove"}),V(b(t(a)("users.Delete")),1)]),_:1})):m("",!0)],32)])):m("",!0),e.$api.auth.hasScope("users.perms.view")?(n(),f("div",re,[$("h1",{textContent:b(t(a)("users.Permissions"))},null,8,te),(n(),f(_,null,H(F,(r,j)=>$("div",{key:r},[j!=="general"?(n(),f("h3",{key:0,textContent:b(z(j))},null,8,ne)):m("",!0),(n(!0),f(_,null,H(r,c=>(n(),y(Z,{key:c,"model-value":l.value.indexOf(c)>=0,disabled:G(c),label:M(c),hint:A(c),"onUpdate:modelValue":le=>J(c)},null,8,["model-value","disabled","label","hint","onUpdate:modelValue"]))),128))])),64)),t(o).auth.hasScope("user.perms.edit")?(n(),y(C,{key:0,color:"primary",onClick:s[9]||(s[9]=r=>T())},{default:k(()=>[w(D,{name:"save"}),V(b(t(a)("users.UpdatePermissions")),1)]),_:1})):m("",!0)])):m("",!0)]))}};export{me as default};
//# sourceMappingURL=UserView-6673e955.js.map
