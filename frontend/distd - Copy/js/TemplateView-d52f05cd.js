import{k as V,l as B,m as L,H as O,r as _,Z as J,p as R,o as u,h as d,A as I,s,q,t as p,C as l,B as i,x as S,N as k}from"./vendor-943aface.js";import{_ as A,a as H}from"./Environment-92ccbbf8.js";import{_ as h,a as G,b as M,c as P}from"./RunConfig-a666fd53.js";import{_ as Z}from"./Ace-74f6f60f.js";import{c as z,a as g,e as b}from"./index-b96ce60d.js";import{T as F,_ as m}from"./Tab-85f76cb0.js";import"./Dropdown-f05f24bf.js";import"./EnvironmentConfig-793daa60.js";import"./Suggestion-7a5f46c0.js";import"./Toggle-edd22afa.js";const K={class:"templateview"},Q={key:1},W={key:0,class:"alert info"},X=["textContent"],Y={key:1,class:"actions"},de={setup(ee){const f=V("api"),j=V("toast"),C=V("events"),{t:n}=B(),r=L(),$=O();let c=null;const a=_(null),v=_({general:!0,run:!0}),y=_(null);J(()=>c===a.value?!0:new Promise(o=>{C.emit("confirm",n("common.ConfirmLeave"),{text:n("common.Discard"),icon:"remove",color:"error",action:()=>{o(!0)}},{color:"primary",action:()=>{o(!1)}})})),R(async()=>{const o=await f.template.get(r.params.repo,r.params.id);delete o.readme,o.environment||(o.environment={}),o.supportedEnvironments||(o.supportedEnvironments=[]),a.value=JSON.stringify(o,void 0,4),setTimeout(()=>{c=a.value},50)});async function N(){!T()||C.emit("confirm",n("templates.ConfirmDelete",{name:JSON.parse(a.value).display}),{text:n("templates.Delete"),icon:"remove",color:"error",action:async()=>{await f.template.delete(r.params.id),j.success(n("templates.Deleted")),$.push({name:"TemplateList"})}},{color:"primary"})}function T(){return r.params.repo==="0"}async function D(){if(!x())return;const o=a.value;await f.template.save(r.params.id,o),c=o,j.success(n("templates.Saved"))}function x(){return r.params.repo!=="0"?!1:Object.values(v.value).filter(o=>o===!1).length===0}function w(){const o=JSON.parse(a.value);delete o.name,sessionStorage.setItem("copiedTemplate",JSON.stringify(o)),$.push({name:"TemplateCreate",query:{copy:!0}})}function E(o){o==="json"&&y.value&&y.value.refresh()}return(o,e)=>(u(),d("div",K,[a.value?(u(),d("div",Q,[s(r).params.repo!=="0"?(u(),d("div",W,[q("span",{textContent:p(s(n)("templates.EditLocalOnly"))},null,8,X),l(g,{color:"primary",onClick:e[0]||(e[0]=t=>w())},{default:i(()=>[l(b,{name:"copy"}),k(p(s(n)("templates.CreateLocalCopy")),1)]),_:1})])):S("",!0),l(F,{anchors:"",onTabChanged:E},{default:i(()=>[l(m,{id:"general",title:s(n)("templates.General"),icon:"general",hotkey:"t g"},{default:i(()=>[l(A,{modelValue:a.value,"onUpdate:modelValue":e[1]||(e[1]=t=>a.value=t),onValid:e[2]||(e[2]=t=>v.value.general=t)},null,8,["modelValue"])]),_:1},8,["title"]),l(m,{id:"variables",title:s(n)("templates.Variables"),icon:"variables",hotkey:"t v"},{default:i(()=>[l(h,{modelValue:a.value,"onUpdate:modelValue":e[3]||(e[3]=t=>a.value=t)},null,8,["modelValue"])]),_:1},8,["title"]),l(m,{id:"install",title:s(n)("templates.Install"),icon:"install",hotkey:"t i"},{default:i(()=>[l(G,{modelValue:a.value,"onUpdate:modelValue":e[4]||(e[4]=t=>a.value=t)},null,8,["modelValue"])]),_:1},8,["title"]),l(m,{id:"run",title:s(n)("templates.RunConfig"),icon:"start",hotkey:"t r"},{default:i(()=>[l(M,{modelValue:a.value,"onUpdate:modelValue":e[5]||(e[5]=t=>a.value=t),onValid:e[6]||(e[6]=t=>v.value.run=t)},null,8,["modelValue"])]),_:1},8,["title"]),l(m,{id:"hooks",title:s(n)("templates.Hooks"),icon:"hooks",hotkey:"t h"},{default:i(()=>[l(P,{modelValue:a.value,"onUpdate:modelValue":e[7]||(e[7]=t=>a.value=t)},null,8,["modelValue"])]),_:1},8,["title"]),l(m,{id:"environment",title:s(n)("templates.Environment"),icon:"environment",hotkey:"t e"},{default:i(()=>[l(H,{modelValue:a.value,"onUpdate:modelValue":e[8]||(e[8]=t=>a.value=t)},null,8,["modelValue"])]),_:1},8,["title"]),l(m,{id:"json",title:s(n)("templates.Json"),icon:"json",hotkey:"t j"},{default:i(()=>[l(Z,{id:"template-json",ref:(t,U)=>{U.ace=t,y.value=t},modelValue:a.value,"onUpdate:modelValue":e[9]||(e[9]=t=>a.value=t),class:"template-json-editor",mode:"json"},null,8,["modelValue"])]),_:1},8,["title"])]),_:1}),s(r).params.repo==="0"?(u(),d("div",Y,[l(g,{color:"error",disabled:!T(),onClick:e[10]||(e[10]=t=>N())},{default:i(()=>[l(b,{name:"remove"}),k(p(s(n)("templates.Delete")),1)]),_:1},8,["disabled"]),l(g,{color:"primary",disabled:!x(),onClick:e[11]||(e[11]=t=>D())},{default:i(()=>[l(b,{name:"save"}),k(p(s(n)("templates.Save")),1)]),_:1},8,["disabled"])])):S("",!0)])):(u(),I(z,{key:0}))]))}};export{de as default};
//# sourceMappingURL=TemplateView-d52f05cd.js.map
