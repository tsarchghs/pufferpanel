{"version":3,"file":"Environment-92ccbbf8.js","sources":["../../src/components/template/General.vue","../../src/components/template/Environment.vue"],"sourcesContent":["<script setup>\nimport { ref, inject, onUpdated } from 'vue'\nimport { useI18n } from 'vue-i18n'\nimport TextField from '@/components/ui/TextField.vue'\n\nconst props = defineProps({\n  idEditable: { type: Boolean, default: () => false },\n  modelValue: { type: String, required: true }\n})\n\nconst emit = defineEmits(['update:modelValue', 'valid'])\n\nconst api = inject('api')\nconst { t } = useI18n()\n\nconst template = ref(JSON.parse(props.modelValue))\nlet nameDebounce = null\nconst nameInvalid = ref(false)\nconst nameUnique = ref(true)\nconst displayInvalid = ref(false)\nconst typeInvalid = ref(false)\n\nfunction update() {\n  emit('update:modelValue', JSON.stringify(template.value, undefined, 4))\n}\n\nfunction nameUpdate() {\n  clearTimeout(nameDebounce)\n  nameDebounce = setTimeout(async () => {\n    if (template.value.name && template.value.name.trim() !== '') {\n      const exists = await api.template.exists(0, template.value.name)\n      nameUnique.value = !exists\n    } else {\n      nameUnique.value = true\n    }\n    validate()\n  }, 500)\n  update()\n}\n\nfunction nameError() {\n  if (nameInvalid.value) {\n    return t('templates.errors.NameInvalid')\n  } else if (!nameUnique.value) {\n    return t('templates.NameNotUnique')\n  } else {\n    return null\n  }\n}\n\nfunction validate() {\n  nameInvalid.value = false\n  displayInvalid.value = false\n  typeInvalid.value = false\n\n  if (!template.value.name || template.value.name.trim() === '') {\n    nameInvalid.value = true\n  }\n\n  if (!template.value.display || template.value.display.trim() === '') {\n    displayInvalid.value = true\n  }\n\n  if (!template.value.type || template.value.type.trim() === '') {\n    typeInvalid.value = true\n  }\n\n  emit('valid', !nameInvalid.value && !displayInvalid.value && !typeInvalid.value)\n}\n\nonUpdated(() => {\n  try {\n    const u = JSON.parse(props.modelValue)\n\n    let needsNameUpdate = false\n    if (u.name && template.value.name && template.value.name !== u.name) {\n      needsNameUpdate = true\n    }\n\n    // reserializing to avoid issues due to formatting\n    if (JSON.stringify(template.value) !== JSON.stringify(u)) {\n      template.value = u\n      validate()\n      if (needsNameUpdate) nameUpdate()\n    }\n  } catch {\n    // expected failure caused by json editor producing invalid json during modification\n  }\n})\n</script>\n\n<template>\n  <div>\n    <text-field v-model=\"template.name\" :disabled=\"!idEditable\" :label=\"t('common.Name')\" :hint=\"idEditable ? t('templates.description.Name') : undefined\" :error=\"nameError()\" @update:modelValue=\"nameUpdate\" @blur=\"validate()\" />\n    <text-field v-model=\"template.display\" :label=\"t('templates.Display')\" :hint=\"t('templates.description.Display')\" :error=\"displayInvalid ? t('templates.errors.DisplayInvalid') : undefined\" @update:modelValue=\"update\" @blur=\"validate()\" />\n    <text-field v-model=\"template.type\" :label=\"t('templates.Type')\" :hint=\"t('templates.description.Type')\" :error=\"typeInvalid ? t('templates.errors.TypeInvalid') : undefined\" @update:modelValue=\"update\" @blur=\"validate()\" />\n  </div>\n</template>\n","<script setup>\nimport { ref, onUpdated } from 'vue'\nimport { useI18n } from 'vue-i18n'\nimport Btn from '@/components/ui/Btn.vue'\nimport Dropdown from '@/components/ui/Dropdown.vue'\nimport Icon from '@/components/ui/Icon.vue'\nimport Overlay from '@/components/ui/Overlay.vue'\nimport EnvironmentConfig from '@/components/ui/EnvironmentConfig.vue'\n\nconst props = defineProps({\n  modelValue: { type: String, required: true }\n})\n\nconst emit = defineEmits(['update:modelValue'])\n\nconst { t } = useI18n()\nconst template = ref(JSON.parse(props.modelValue))\nconst edit = ref({})\nconst editing = ref(false)\nconst adding = ref(false)\nconst editIndex = ref(0)\nconst envs = [\n  { value: 'host', label: t('env.host.name') },\n  { value: 'docker', label: t('env.docker.name') }\n]\nconst envDefaults = {\n  host: { type: 'host' },\n  docker: { type: 'docker', image: 'pufferpanel/generic' }\n}\n\nfunction update() {\n  emit('update:modelValue', JSON.stringify(template.value, undefined, 4))\n}\n\nfunction editEnvChanged(newEnv) {\n  edit.value = envDefaults[newEnv]\n}\n\nonUpdated(() => {\n  try {\n    const u = JSON.parse(props.modelValue)\n    // reserializing to avoid issues due to formatting\n    if (JSON.stringify(template.value) !== JSON.stringify(u))\n      template.value = u\n  } catch {\n    // expected failure caused by json editor producing invalid json during modification\n  }\n})\n\nfunction unsupportedEnvs() {\n  return envs.filter(env => {\n    return template.value.supportedEnvironments.filter(e => e.type === env.value).length === 0\n  })\n}\n\nfunction addEnv() {\n  edit.value = envDefaults[unsupportedEnvs()[0].value]\n  adding.value = true\n  editing.value = true\n}\n\nfunction editEnv(index) {\n  edit.value = template.value.supportedEnvironments[index]\n  editIndex.value = index\n  editing.value = true\n}\n\nfunction cancelEdit() {\n  editing.value = false\n  adding.value = false\n  edit.value = {}\n  editIndex.value = 0\n}\n\nfunction confirmEdit() {\n  if (adding.value === true) {\n    template.value.supportedEnvironments.push(edit.value)\n  } else {\n    template.value.supportedEnvironments[editIndex.value] = edit.value\n  }\n  cancelEdit()\n  update()\n}\n\nfunction removeEnv(index) {\n  const env = template.value.supportedEnvironments[index]\n  template.value.supportedEnvironments.splice(index, 1)\n  if (template.value.environment.type === env.type) template.value.environment = template.value.supportedEnvironments[0]\n  update()\n}\n</script>\n\n<template>\n  <div class=\"environments\">\n    <ul class=\"list\">\n      <li v-for=\"(env, index) in template.supportedEnvironments\" :key=\"env.type\" class=\"list-item clickable\">\n        <div class=\"list-item-content\" @click=\"editEnv(index)\">\n          <span v-text=\"t(`env.${env.type}.name`)\" />\n          <btn :disabled=\"template.supportedEnvironments.length < 2\" variant=\"icon\" @click.stop=\"removeEnv(index)\"><icon name=\"remove\" /></btn>\n        </div>\n      </li>\n    </ul>\n    <btn :disabled=\"unsupportedEnvs().length === 0\" variant=\"text\" @click=\"addEnv()\"><icon name=\"plus\" />{{ t('templates.AddEnvironment') }}</btn>\n    <overlay v-model=\"editing\">\n      <dropdown v-if=\"adding\" v-model=\"edit.type\" :options=\"unsupportedEnvs()\" :label=\"t('templates.Environment')\" @update:modelValue=\"editEnvChanged\" />\n      <environment-config v-model=\"edit\" :no-fields-message=\"t('env.NoEnvFields')\" />\n      <div class=\"actions\">\n        <btn color=\"error\" @click=\"cancelEdit()\"><icon name=\"close\" />{{ t('common.Cancel') }}</btn>\n        <btn color=\"primary\" @click=\"confirmEdit()\"><icon name=\"check\" />{{ t('common.Confirm') }}</btn>\n      </div>\n    </overlay>\n  </div>\n</template>\n"],"names":[],"mappings":"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"}