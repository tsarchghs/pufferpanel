{"version":3,"file":"Settings-fd992e6e.js","sources":["../../src/views/Settings.vue"],"sourcesContent":["<script setup>\nimport { ref, inject, onMounted } from 'vue'\nimport { useI18n } from 'vue-i18n'\nimport Btn from '@/components/ui/Btn.vue'\nimport Dropdown from '@/components/ui/Dropdown.vue'\nimport Icon from '@/components/ui/Icon.vue'\nimport TextField from '@/components/ui/TextField.vue'\nimport ThemeSetting from '@/components/ui/ThemeSetting.vue'\nimport Toggle from '@/components/ui/Toggle.vue'\n\nconst emailProviderConfigs = {\n  none: [],\n  smtp: [\n    { key: 'from', type: 'text' },\n    { key: 'host', type: 'text' },\n    { key: 'username', type: 'text' },\n    { key: 'password', type: 'password' }\n  ],\n  mailgun: [\n    { key: 'domain', type: 'text' },\n    { key: 'from', type: 'text' },\n    { key: 'key', type: 'text' }\n  ],\n  mailjet: [\n    { key: 'domain', type: 'text' },\n    { key: 'from', type: 'text' },\n    { key: 'key', type: 'text' }\n  ]\n}\n\nconst { t } = useI18n()\nconst api = inject('api')\nconst toast = inject('toast')\nconst themeApi = inject('theme')\n\nconst masterUrl = ref('')\nconst panelTitle = ref('')\nconst registrationEnabled = ref(true)\nconst theme = ref('PufferPanel')\nconst themeSettings = ref([])\n\nconst emailProviders = []\nObject.keys(emailProviderConfigs).map(provider => {\n  emailProviders.push({\n    label: t('settings.emailProviders.' + provider),\n    value: provider\n  })\n})\nif (import.meta.env.DEV) {\n  emailProviderConfigs.debug = []\n  emailProviders.push({ label: 'Debug', value: 'debug' })\n}\nconst emailProvider = ref('none')\nconst emailFields = ref([])\nconst email = ref({\n  from: '',\n  domain: '',\n  key: '',\n  host: '',\n  username: '',\n  password: ''\n})\n\nfunction autofillMasterUrl() {\n  masterUrl.value = window.location.origin\n}\n\nasync function themeChanged() {\n  themeSettings.value = await themeApi.getThemeSettings(theme.value)\n}\n\nfunction emailProviderChanged() {\n  emailFields.value = emailProviderConfigs[emailProvider.value]\n}\n\nasync function savePanelSettings() {\n  await api.settings.set({\n    'panel.settings.masterUrl': masterUrl.value,\n    'panel.settings.companyName': panelTitle.value,\n    'panel.settings.defaultTheme': theme.value,\n    'panel.settings.themeSettings': themeApi.serializeThemeSettings(themeSettings.value),\n    'panel.registrationEnabled': registrationEnabled.value\n  })\n  toast.success(t('settings.Saved'))\n}\n\nasync function saveEmailSettings() {\n  const data = { 'panel.email.provider': emailProvider.value }\n  emailFields.value.map(elem => {\n    data['panel.email.' + elem.key] = email[elem.key]\n  })\n  await api.settings.set(data)\n  toast.success(t('settings.Saved'))\n}\n\nonMounted(async () => {\n  masterUrl.value = await api.settings.get('panel.settings.masterUrl')\n  panelTitle.value = await api.settings.get('panel.settings.companyName')\n  registrationEnabled.value = (await api.settings.get('panel.registrationEnabled')) === \"true\"\n  theme.value = await api.settings.get('panel.settings.defaultTheme')\n  emailProvider.value = await api.settings.get('panel.email.provider')\n  Object.keys(email.value).map(async key => {\n    email.value[key] = await api.settings.get('panel.email.' + key)\n  })\n  await themeChanged()\n  themeSettings.value = themeApi.deserializeThemeSettings(\n    themeSettings.value,\n    await api.settings.get('panel.settings.themeSettings')\n  )\n})\n\nfunction updateThemeSetting(name, newSetting) {\n  themeSettings.value[name] = newSetting\n}\n</script>\n\n<template>\n  <div class=\"settings\">\n    <div class=\"panel\">\n      <h1 v-text=\"t('settings.PanelSettings')\" />\n      <div class=\"master-url\">\n        <text-field v-model=\"masterUrl\" :label=\"t('settings.MasterUrl')\" :hint=\"t('settings.MasterUrlHint')\" />\n        <icon name=\"auto-fix\" @click=\"autofillMasterUrl()\" />\n      </div>\n      <text-field v-model=\"panelTitle\" :label=\"t('settings.CompanyName')\" />\n      <toggle v-model=\"registrationEnabled\" :label=\"t('settings.RegistrationEnabled')\" :hint=\"t('settings.RegistrationEnabledHint')\" />\n      <dropdown v-model=\"theme\" :options=\"$theme.getThemes()\" :label=\"t('settings.DefaultTheme')\" @change=\"themeChanged()\" />\n      <theme-setting v-for=\"(setting, name) in themeSettings\" :key=\"name\" :model-value=\"setting\" @update:modelValue=\"updateThemeSetting(name, $event)\" />\n      <btn color=\"primary\" @click=\"savePanelSettings()\"><icon name=\"save\" />{{ t('settings.SavePanelSettings') }}</btn>\n    </div>\n    <div class=\"email\">\n      <h1 v-text=\"t('settings.EmailSettings')\" />\n      <dropdown v-model=\"emailProvider\" :options=\"emailProviders\" :label=\"t('settings.EmailProvider')\" @change=\"emailProviderChanged()\" />\n      <text-field v-for=\"elem in emailFields\" :key=\"elem.key\" v-model=\"email[elem.key]\" :type=\"elem.type\" :label=\"t('settings.email.' + elem.key)\" />\n      <btn color=\"primary\" @click=\"saveEmailSettings()\"><icon name=\"save\" />{{ t('settings.SaveEmailSettings') }}</btn>\n    </div>\n  </div>\n</template>\n"],"names":[],"mappings":"4bAUA,KAAM,GAAuB,CAC3B,KAAM,GACN,KAAM,CACJ,CAAE,IAAK,OAAQ,KAAM,QACrB,CAAE,IAAK,OAAQ,KAAM,QACrB,CAAE,IAAK,WAAY,KAAM,QACzB,CAAE,IAAK,WAAY,KAAM,aAE3B,QAAS,CACP,CAAE,IAAK,SAAU,KAAM,QACvB,CAAE,IAAK,OAAQ,KAAM,QACrB,CAAE,IAAK,MAAO,KAAM,SAEtB,QAAS,CACP,CAAE,IAAK,SAAU,KAAM,QACvB,CAAE,IAAK,OAAQ,KAAM,QACrB,CAAE,IAAK,MAAO,KAAM,UAIlB,CAAE,KAAM,IACR,EAAM,EAAO,OACb,EAAQ,EAAO,SACf,EAAW,EAAO,SAElB,EAAY,EAAI,IAChB,EAAa,EAAI,IACjB,EAAsB,EAAI,IAC1B,EAAQ,EAAI,eACZ,EAAgB,EAAI,IAEpB,EAAiB,GACvB,OAAO,KAAK,GAAsB,IAAI,GAAY,CAChD,EAAe,KAAK,CAClB,MAAO,EAAE,2BAA6B,GACtC,MAAO,MAOX,KAAM,GAAgB,EAAI,QACpB,EAAc,EAAI,IAClB,EAAQ,EAAI,CAChB,KAAM,GACN,OAAQ,GACR,IAAK,GACL,KAAM,GACN,SAAU,GACV,SAAU,KAGZ,YAA6B,CAC3B,EAAU,MAAQ,OAAO,SAAS,OAGpC,kBAA8B,CAC5B,EAAc,MAAQ,KAAM,GAAS,iBAAiB,EAAM,OAG9D,YAAgC,CAC9B,EAAY,MAAQ,EAAqB,EAAc,OAGzD,kBAAmC,CACjC,KAAM,GAAI,SAAS,IAAI,CACrB,2BAA4B,EAAU,MACtC,6BAA8B,EAAW,MACzC,8BAA+B,EAAM,MACrC,+BAAgC,EAAS,uBAAuB,EAAc,OAC9E,4BAA6B,EAAoB,QAEnD,EAAM,QAAQ,EAAE,mBAGlB,kBAAmC,CACjC,KAAM,GAAO,CAAE,uBAAwB,EAAc,OACrD,EAAY,MAAM,IAAI,GAAQ,CAC5B,EAAK,eAAiB,EAAK,KAAO,EAAM,EAAK,OAE/C,KAAM,GAAI,SAAS,IAAI,GACvB,EAAM,QAAQ,EAAE,mBAGlB,EAAU,SAAY,CACpB,EAAU,MAAQ,KAAM,GAAI,SAAS,IAAI,4BACzC,EAAW,MAAQ,KAAM,GAAI,SAAS,IAAI,8BAC1C,EAAoB,MAAS,KAAM,GAAI,SAAS,IAAI,+BAAkC,OACtF,EAAM,MAAQ,KAAM,GAAI,SAAS,IAAI,+BACrC,EAAc,MAAQ,KAAM,GAAI,SAAS,IAAI,wBAC7C,OAAO,KAAK,EAAM,OAAO,IAAI,KAAM,IAAO,CACxC,EAAM,MAAM,GAAO,KAAM,GAAI,SAAS,IAAI,eAAiB,KAE7D,KAAM,KACN,EAAc,MAAQ,EAAS,yBAC7B,EAAc,MACd,KAAM,GAAI,SAAS,IAAI,mCAI3B,WAA4B,EAAM,EAAY,CAC5C,EAAc,MAAM,GAAQ"}