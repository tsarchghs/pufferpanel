var z=Object.defineProperty;var j=Object.getOwnPropertySymbols;var G=Object.prototype.hasOwnProperty,K=Object.prototype.propertyIsEnumerable;var B=(p,u,r)=>u in p?z(p,u,{enumerable:!0,configurable:!0,writable:!0,value:r}):p[u]=r,M=(p,u)=>{for(var r in u||(u={}))G.call(u,r)&&B(p,r,u[r]);if(j)for(var r of j(u))K.call(u,r)&&B(p,r,u[r]);return p};import{k as N,l as Q,m as X,H as Y,r as d,p as Z,o as v,h as H,q as a,t as s,A as $,s as n,C as i,x as A,B as U,N as E}from"./vendor-943aface.js";import{c as ee,_ as k,a as g,m as O,b as te,e as R}from"./index-b96ce60d.js";import{_ as ne}from"./Toggle-edd22afa.js";const oe={class:"nodeview"},le=["textContent"],ae={key:1,class:"features"},se=["textContent"],ue={key:2,class:"features"},re=["textContent"],de={class:"os"},ie=["textContent"],ve=["textContent"],ce={class:"arch"},pe=["textContent"],me=["textContent"],fe={class:"env"},be=["textContent"],Ce=["textContent"],xe={class:"docker"},_e=["textContent"],ye=["textContent"],ke=["textContent"],Ve={key:3,class:"edit"},he=["innerHTML"],Pe=["innerHTML"],Ne={setup(p){const u=N("api"),r=N("toast"),q=N("events"),{t}=Q(),m=X(),F=Y(),V=d(!1);let D={};const f=d(!1),b=d(""),C=d(""),x=d("8080"),h=d(""),_=d("8080"),y=d("5657"),w=d(1),P=d(null),c=d({});Z(async()=>{const o=await u.node.get(m.params.id);b.value=o.name,C.value=o.publicHost,x.value=o.publicPort,h.value=o.privateHost,_.value=o.privatePort,y.value=o.sftpPort,f.value=!(o.publicHost===o.privateHost&&o.publicPort===o.privatePort),D=await u.node.deployment(m.params.id),m.query.created&&(V.value=!0),S()});async function S(){P.value=null,c.value={};try{const o=await u.node.features(m.params.id);c.value.envs=[...new Set(o.environments.map(e=>e==="standard"||e==="tty"?"host":e))].map(e=>t(`env.${e}.name`)),c.value.docker=o.features.indexOf("docker")!==-1,c.value.os=o.os,c.value.arch=o.arch,P.value=!0}catch{P.value=!1}}function L(){return!(!b.value||!C.value||!x.value||!y.value||f.value&&(!h.value||!_.value))}async function W(){if(!L())return;const o={name:b.value,publicHost:C.value,publicPort:x.value,sftpPort:y.value};f.value?(o.privateHost=h.value,o.privatePort=_.value):(o.privateHost=C.value,o.privatePort=x.value),await u.node.update(m.params.id,o),r.success(t("nodes.Updated"))}async function I(){q.emit("confirm",t("nodes.ConfirmDelete",{name:b.value}),{text:t("nodes.Delete"),icon:"remove",color:"error",action:async()=>{await u.node.delete(m.params.id),r.success(t("nodes.Deleted")),F.push({name:"NodeList"})}},{color:"primary"})}function J(){const o={logs:"/var/log/pufferpanel",web:{host:`0.0.0.0:${_.value}`},token:{public:location.origin+"/auth/publickey"},panel:{enable:!1},daemon:{auth:M({url:location.origin+"/oauth2/token"},D),data:{root:"/var/lib/pufferpanel"},sftp:{host:`0.0.0.0:${y.value}`}}};return JSON.stringify(o,void 0,2)}function T(){V.value=!1,w.value=1,S()}return(o,e)=>(v(),H("div",oe,[a("h1",{textContent:s(b.value)},null,8,le),P.value===null?(v(),$(ee,{key:0})):P.value===!1?(v(),H("div",ae,[a("div",{class:"unreachable",textContent:s(n(t)("nodes.Unreachable"))},null,8,se)])):(v(),H("div",ue,[a("div",{class:"reachable",textContent:s(n(t)("nodes.Reachable"))},null,8,re),a("div",de,[a("span",{textContent:s(n(t)("nodes.features.os.label"))},null,8,ie),a("span",{textContent:s(n(t)("nodes.features.os."+c.value.os))},null,8,ve)]),a("div",ce,[a("span",{textContent:s(n(t)("nodes.features.arch.label"))},null,8,pe),a("span",{textContent:s(n(t)("nodes.features.arch."+c.value.arch))},null,8,me)]),a("div",fe,[a("span",{textContent:s(n(t)("nodes.features.envs"))},null,8,be),a("span",{textContent:s(c.value.envs.join(", "))},null,8,Ce)]),a("div",xe,[a("span",{textContent:s(n(t)("env.docker.name"))},null,8,_e),a("span",{textContent:s(n(t)("nodes.features.docker."+c.value.docker))},null,8,ye)])])),a("h2",{textContent:s(n(t)("nodes.Edit"))},null,8,ke),n(m).params.id>0?(v(),H("div",Ve,[i(k,{modelValue:b.value,"onUpdate:modelValue":e[0]||(e[0]=l=>b.value=l),class:"name",label:n(t)("common.Name")},null,8,["modelValue","label"]),i(k,{modelValue:C.value,"onUpdate:modelValue":e[1]||(e[1]=l=>C.value=l),class:"public-host",label:n(t)("nodes.PublicHost")},null,8,["modelValue","label"]),i(k,{modelValue:x.value,"onUpdate:modelValue":e[2]||(e[2]=l=>x.value=l),class:"public-port",label:n(t)("nodes.PublicPort"),type:"number"},null,8,["modelValue","label"]),i(ne,{modelValue:f.value,"onUpdate:modelValue":e[3]||(e[3]=l=>f.value=l),class:"private-toggle",label:n(t)("nodes.WithPrivateAddress"),hint:n(t)("nodes.WithPrivateAddressHint")},null,8,["modelValue","label","hint"]),f.value?(v(),$(k,{key:0,modelValue:h.value,"onUpdate:modelValue":e[4]||(e[4]=l=>h.value=l),class:"private-host",label:n(t)("nodes.PrivateHost")},null,8,["modelValue","label"])):A("",!0),f.value?(v(),$(k,{key:1,modelValue:_.value,"onUpdate:modelValue":e[5]||(e[5]=l=>_.value=l),class:"private-port",label:n(t)("nodes.PrivatePort"),type:"number"},null,8,["modelValue","label"])):A("",!0),i(k,{modelValue:y.value,"onUpdate:modelValue":e[6]||(e[6]=l=>y.value=l),class:"sftp-port",label:n(t)("nodes.SftpPort"),type:"number"},null,8,["modelValue","label"]),i(g,{disabled:!L(),color:"primary",onClick:e[7]||(e[7]=l=>W())},{default:U(()=>[i(R,{name:"save"}),E(s(n(t)("nodes.Update")),1)]),_:1},8,["disabled"]),i(g,{color:"error",onClick:e[8]||(e[8]=l=>I())},{default:U(()=>[i(R,{name:"remove"}),E(s(n(t)("nodes.Delete")),1)]),_:1}),i(g,{onClick:e[9]||(e[9]=l=>V.value=!0),textContent:s(n(t)("nodes.Deploy"))},null,8,["textContent"])])):(v(),H("div",{key:4,class:"edit",innerHTML:n(O)(n(t)("nodes.LocalNodeEdit"))},null,8,he)),i(te,{modelValue:V.value,"onUpdate:modelValue":e[12]||(e[12]=l=>V.value=l),closable:"",title:n(t)("nodes.Deploy"),onClose:e[13]||(e[13]=l=>T())},{default:U(()=>[a("div",{innerHTML:n(O)(n(t)(`nodes.deploy.Step${w.value}`,{config:J()}))},null,8,Pe),w.value<5?(v(),$(g,{key:0,onClick:e[10]||(e[10]=l=>w.value+=1),textContent:s(n(t)("common.Next"))},null,8,["textContent"])):(v(),$(g,{key:1,onClick:e[11]||(e[11]=l=>T()),textContent:s(n(t)("common.Close"))},null,8,["textContent"]))]),_:1},8,["modelValue","title"])]))}};export{Ne as default};
//# sourceMappingURL=NodeView-9300caca.js.map
