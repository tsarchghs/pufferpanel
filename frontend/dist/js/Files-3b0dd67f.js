var xe=Object.defineProperty,Fe=Object.defineProperties;var be=Object.getOwnPropertyDescriptors;var ee=Object.getOwnPropertySymbols;var Ve=Object.prototype.hasOwnProperty,$e=Object.prototype.propertyIsEnumerable;var te=(v,n,l)=>n in v?xe(v,n,{enumerable:!0,configurable:!0,writable:!0,value:l}):v[n]=l,K=(v,n)=>{for(var l in n||(n={}))Ve.call(n,l)&&te(v,l,n[l]);if(ee)for(var l of ee(n))$e.call(n,l)&&te(v,l,n[l]);return v},W=(v,n)=>Fe(v,be(n));import{l as H,T as G,y as J,o as f,h as S,q as d,t as h,A as U,B as y,C as s,N,x as w,z as P,k as le,r as F,s as r,p as Se,L as Ue,F as ze,v as Be,I as Ee,P as q}from"./vendor-943aface.js";import{f as Me,a as b,e as x,b as A,c as ae,_ as ne}from"./index-b96ce60d.js";import{_ as je}from"./Ace-74f6f60f.js";const C={};C[".jpg"]={type:"image",disableSave:!0};C[".jpeg"]={type:"image",disableSave:!0};C[".png"]={type:"image",disableSave:!0};C[".gif"]={type:"image",disableSave:!0};C[".mp3"]={type:"audio",disableSave:!0};C[".wav"]={type:"audio",disableSave:!0};C[".ogg"]={type:"audio",disableSave:!0};C[".flac"]={type:"audio",disableSave:!0};C[".aac"]={type:"audio",disableSave:!0};C[".alac"]={type:"audio",disableSave:!0};C[".mp4"]={type:"video",disableSave:!0};C[".webm"]={type:"video",disableSave:!0};C[".avi"]={type:"video",disableSave:!0};C[".mkv"]={type:"video",disableSave:!0};C[".m4a"]={type:"video",disableSave:!0};function oe(v){return(C[v.extension]||{}).type}function Q(v){return["image","audio","video"].indexOf(oe(v))!==-1}const Oe={components:{Ace:je,Btn:b,Icon:x},props:{readOnly:{type:Boolean,default:()=>!1},modelValue:{type:Object,required:!0}},emits:["update:modelValue","save","close"],setup(v,{emit:n}){const{t:l}=H();function m(j){n("update:modelValue",W(K({},v.modelValue),{content:j}))}return{t:l,emit:n,emitUpdate:m,extensions:C,getType:oe,skipDownload:Q}}},Pe={class:"overlay-header"},Te=["textContent"],Ae=["src"],De={key:1,class:"file-viewer",controls:""},Le=["src"],Ne=["textContent"],Ie={key:2,class:"file-viewer",controls:""},qe=["src"],Re=["textContent"];function Ke(v,n,l,m,j,V){const z=G("icon"),u=G("btn"),B=G("ace"),E=J("hotkey");return f(),S("div",null,[d("div",Pe,[d("h1",{class:"title",textContent:h(l.modelValue.name)},null,8,Te),!l.readOnly&&!(m.extensions[l.modelValue.extension]||{}).disableSave?(f(),U(u,{key:0,variant:"text",onClick:n[0]||(n[0]=T=>m.emit("save"))},{default:y(()=>[s(z,{name:"save"}),N(" "+h(m.t("common.Save")),1)]),_:1})):w("",!0),P(s(u,{variant:"icon",onClick:n[1]||(n[1]=T=>m.emit("close"))},{default:y(()=>[s(z,{name:"close"})]),_:1},512),[[E,"Escape"]])]),m.getType(l.modelValue)==="image"?(f(),S("img",{key:0,class:"file-viewer",src:l.modelValue.url},null,8,Ae)):m.getType(l.modelValue)==="video"?(f(),S("video",De,[d("source",{src:l.modelValue.url},null,8,Le),d("div",{class:"warning unsupported",textContent:h(m.t("errors.VideoUnsupported"))},null,8,Ne)])):m.getType(l.modelValue)==="audio"?(f(),S("audio",Ie,[d("source",{src:l.modelValue.url},null,8,qe),d("div",{class:"warning unsupported",textContent:h(m.t("errors.AudioUnsupported"))},null,8,Re)])):(f(),U(B,{key:3,id:"file-editor","read-only":l.readOnly,"model-value":l.modelValue.content,class:"file-editor",file:l.modelValue.name,theme:"monokai","onUpdate:modelValue":m.emitUpdate},null,8,["read-only","model-value","file","onUpdate:modelValue"]))])}var We=Me(Oe,[["render",Ke]]);const He=["webkitdirectory"],Ge={key:0},Je={class:"progress"},Qe=["textContent"],Xe=d("progress",null,null,-1),Ye={key:1},Ze={class:"progress"},et=["textContent"],tt=d("progress",null,null,-1),lt={key:2},at=["textContent"],nt=["textContent"],ot={class:"progress"},it=["textContent"],st=["max","value"],rt={class:"progress"},ut=["textContent"],dt=["max","value"],ie={props:{server:{type:Object,required:!0},folder:{type:Boolean,default:()=>!1},hotkey:{type:String,default:()=>{}},path:{type:String,required:!0}},emits:["uploaded"],setup(v,{emit:n}){const l=v,{t:m}=H(),j=le("toast"),V=F(null),z=F(!1),u=F(null);function B(){V.value.click()}async function E(k){u.value={state:"create folders"};const i=new Set,p=new Set;for(let c=0;c<k.length;c++){let o=k[c].webkitRelativePath.split("/");if(o.pop(),o=[l.path,...o].join("/"),i.has(o)||p.has(o))continue;const O=await l.server.fileExists(o);if(O||i.add(o),O==="folder"&&p.add(o),O==="file")throw`${o} exists as file`}for(let c of i)await l.server.createFolder(c)}function T(k){const i=u.value.current,p=u.value.files[i];p.progress=Math.min(k.loaded,p.size)}async function M(k){u.value={state:"preparing"},z.value=!0;try{k.target.webkitdirectory&&await E(k.target.files),u.value={state:"upload files",current:0,total:k.target.files.length,files:[]};for(let i=0;i<k.target.files.length;i++){const p=k.target.files[i];u.value.files[i+1]={name:p.webkitRelativePath||p.name,size:p.size,progress:0}}for(let i=0;i<k.target.files.length;i++){u.value.current=i+1;const p=k.target.files[i];let c=l.path+"/";p.webkitRelativePath?c=c+p.webkitRelativePath:c=c+p.name,await l.server.uploadFile(c,p,T)}}catch(i){console.error("file upload failed",i),j.error(m("files.UploadFailed"))}finally{j.success(m("files.UploadSuccess")),n("uploaded"),z.value=!1,u.value=null}}return(k,i)=>{const p=J("hotkey");return f(),S("div",null,[P(s(b,{variant:"icon",tooltip:r(m)(v.folder?"files.UploadFolder":"files.UploadFile"),onClick:i[0]||(i[0]=c=>B())},{default:y(()=>[s(x,{name:v.folder?"folder-upload":"file-upload"},null,8,["name"])]),_:1},8,["tooltip"]),[[p,v.hotkey]]),d("input",{ref:(c,o)=>{o.input=c,V.value=c},type:"file",multiple:"",webkitdirectory:v.folder,onChange:M},null,40,He),s(A,{modelValue:z.value,"onUpdate:modelValue":i[1]||(i[1]=c=>z.value=c),class:"file-upload-progress",title:r(m)("files.UploadProgress")},{default:y(()=>[u.value.state==="preparing"?(f(),S("div",Ge,[d("div",Je,[d("span",{textContent:h(r(m)("files.PreparingUpload"))},null,8,Qe),Xe])])):w("",!0),u.value.state==="create folders"?(f(),S("div",Ye,[d("div",Ze,[d("span",{textContent:h(r(m)("files.CreatingFolders"))},null,8,et),tt])])):w("",!0),u.value.state==="upload files"?(f(),S("div",lt,[d("div",{class:"upload-file-count",textContent:h(r(m)("files.CurrentlyUploading",{current:u.value.current,total:u.value.total}))},null,8,at),d("div",{class:"upload-file-name",textContent:h(u.value.files[u.value.current].name)},null,8,nt),d("div",ot,[d("span",{textContent:h(r(m)("files.Current"))},null,8,it),d("progress",{max:u.value.files[u.value.current].size,value:u.value.files[u.value.current].progress},null,8,st)]),d("div",rt,[d("span",{textContent:h(r(m)("files.Total"))},null,8,ut),d("progress",{max:u.value.files.reduce((c,o)=>c+o.size,0),value:u.value.files.reduce((c,o)=>c+o.progress,0)},null,8,dt)])])):w("",!0)]),_:1},8,["modelValue","title"])])}}},vt={class:"file-manager"},ct={class:"header"},ft=["textContent"],mt=["textContent"],pt=d("span",{class:"spacer"},null,-1),yt=["onClick","onKeydown"],kt={class:"details"},gt={class:"name"},_t={key:0,class:"size"},ht=["href"],bt={props:{server:{type:Object,required:!0}},setup(v){const n=v,{t:l}=H(),m=le("events"),j="webkitdirectory"in document.createElement("input"),V=n.server.hasScope("server.files.edit"),z=F([]),u=F(null),B=F(null),E=F(!1),T=F(null),M=F([]),k=F(!1),i=F(!1),p=F(!1),c=F(!1),o=F("");let O,R;Se(()=>{$(),R=n.server.on("status",()=>{$()}),O=n.server.startTask(()=>{$()},5*60*1e3)}),Ue(async()=>{R&&R(),O&&n.server.stopTask(O)});async function $(t=!1){t&&(u.value=null);const e=await n.server.getFile(_());u.value=e.sort(X)}function X(t,e){return t.isFile&&!e.isFile?1:!t.isFile&&e.isFile||t.name.toLowerCase()<e.name.toLowerCase()?-1:1}function _(){return M.value.map(t=>t.name).join("/")}async function D(t,e=!1){if(t.isFile){if(!Q(t)&&!e&&t.size>30*Math.pow(2,20)){T.value=t,E.value=!0;return}E.value=!1,i.value=!0;const g=_()+`/${t.name}`,a=Q(t)?null:await n.server.getFile(g,!0);B.value=W(K({},t),{content:a,url:n.server.getFileUrl(g)}),k.value=!0,i.value=!1}else{let g="";t.name===".."?(M.value.pop(),g=_()):g=_()+`/${t.name}`;const a=await n.server.getFile(g);u.value=a.sort(X),t.name!==".."&&M.value.push(t)}}async function se(){await n.server.uploadFile(`${_()}/${B.value.name}`,B.value.content),k.value=!1,B.value=null,$()}function re(t){return t.isFile?t.extension?"file-"+t.extension.substring(1):"file":"folder"}function ue(t){m.emit("confirm",l("files.ConfirmDelete",{name:t.name}),{text:l("files.Delete"),icon:"remove",color:"error",action:async()=>{await n.server.deleteFile(_()+"/"+t.name),await $()}},{color:"primary"})}const L=new Intl.NumberFormat("en-US",{maximumFractionDigits:2});function de(t){return t?t<Math.pow(2,10)?L.format(t)+" B":t<Math.pow(2,20)?L.format(t/Math.pow(2,10))+" KiB":t<Math.pow(2,30)?L.format(t/Math.pow(2,20))+" MiB":t<Math.pow(2,40)?L.format(t/Math.pow(2,30))+" GiB":L.format(t/Math.pow(2,40))+" TiB":"0 B"}function ve(){o.value="",p.value=!0}function ce(){o.value="",c.value=!0}async function fe(){if(!o.value||o.value.trim()==="")return;await n.server.uploadFile(`${_()}/${o.value}`,"");const t={name:o.value,size:0,isFile:!0};p.value=!1,o.value="",await D(t),await $()}async function me(){if(!o.value||o.value.trim()==="")return;await n.server.createFolder(`${_()}/${o.value}`);const t={name:o.value,isFile:!1};c.value=!1,o.value="",await D(t),await $()}const Y=[".7z",".bz2",".gz",".lz",".lzma",".rar",".tar",".tgz",".xz",".zip",".zipx"];function pe(t){const e=t.name.toLowerCase();for(let g=0;g<Y.length;g++)if(e.endsWith(Y[g]))return!0;return!1}async function ye(t){i.value=!0;try{let e=_();e.startsWith("/")||(e="/"+e),await n.server.extractFile(`${_()}/${t.name}`,e),$()}finally{i.value=!1}}async function Z(t){let e=`${_()}/${t}.zip`;for(let g=2;await n.server.fileExists(e);g++)e=`${_()}/${t} (${g}).zip`;return e}async function ke(){i.value=!0;try{const t=M.value[M.value.length-1];let e=n.server.id;t!==void 0&&(e=M.value[M.value.length-1].name),await n.server.archiveFile(await Z(e),`${_()}`)}finally{setTimeout(()=>{$(),i.value=!1},500)}}async function ge(t){i.value=!0;try{await n.server.archiveFile(await Z(t.name),`${_()}/${t.name}`)}finally{setTimeout(()=>{$(),i.value=!1},500)}}function _e(t){return n.server.getFileUrl(_()+"/"+t.name)}function he(){z.value[0]&&z.value[0].focus()}function Ce(t){return e=>z.value[t]=e}return(t,e)=>{const g=J("hotkey");return f(),S("div",vt,[d("div",ct,[d("h2",{textContent:h(r(l)("servers.Files"))},null,8,ft),d("h3",{textContent:h("/"+_())},null,8,mt),pt,r(V)?P((f(),U(b,{key:0,variant:"icon",tooltip:r(l)("files.ArchiveCurrent"),onClick:e[0]||(e[0]=a=>ke())},{default:y(()=>[s(x,{name:"archive"})]),_:1},8,["tooltip"])),[[g,"f a"]]):w("",!0),r(V)?(f(),U(ie,{key:1,path:_(),server:v.server,hotkey:"f u",onUploaded:e[1]||(e[1]=a=>$())},null,8,["path","server"])):w("",!0),r(V)&&j?(f(),U(ie,{key:2,path:_(),server:v.server,folder:"",hotkey:"f d",onUploaded:e[2]||(e[2]=a=>$())},null,8,["path","server"])):w("",!0),r(V)?P((f(),U(b,{key:3,variant:"icon",tooltip:r(l)("files.CreateFile"),onClick:e[3]||(e[3]=a=>ve())},{default:y(()=>[s(x,{name:"file-create"})]),_:1},8,["tooltip"])),[[g,"f c f"]]):w("",!0),r(V)?P((f(),U(b,{key:4,variant:"icon",tooltip:r(l)("files.CreateFolder"),onClick:e[4]||(e[4]=a=>ce())},{default:y(()=>[s(x,{name:"folder-create"})]),_:1},8,["tooltip"])),[[g,"f c d"]]):w("",!0),P(s(b,{variant:"icon",tooltip:r(l)("files.Refresh"),onClick:e[5]||(e[5]=a=>$(!0))},{default:y(()=>[s(x,{name:"reload"})]),_:1},8,["tooltip"]),[[g,"f r"]])]),P(d("div",{class:"file-list",onHotkey:he},[Array.isArray(u.value)?(f(!0),S(ze,{key:1},Be(u.value,(a,we)=>(f(),S("a",{key:a.name,ref:Ce(we),tabindex:"0",class:"file",onClick:I=>D(a),onKeydown:Ee(I=>D(a),["enter"])},[s(x,{class:"file-icon",name:re(a)},null,8,["name"]),d("div",kt,[d("div",gt,h(a.name),1),a.isFile?(f(),S("div",_t,h(de(a.size)),1)):w("",!0)]),r(V)&&a.name!==".."&&!a.isFile?(f(),U(b,{key:0,tabindex:"-1",variant:"icon",tooltip:r(l)("files.Archive"),onClick:q(I=>ge(a),["stop"])},{default:y(()=>[s(x,{name:"archive"})]),_:2},1032,["tooltip","onClick"])):w("",!0),r(V)&&a.isFile&&pe(a)?(f(),U(b,{key:1,tabindex:"-1",variant:"icon",tooltip:r(l)("files.Extract"),onClick:q(I=>ye(a),["stop"])},{default:y(()=>[s(x,{name:"extract"})]),_:2},1032,["tooltip","onClick"])):w("",!0),a.isFile?(f(),S("a",{key:2,tabindex:"-1",class:"dl-link",href:_e(a),target:"_blank",rel:"noopener"},[s(b,{tabindex:"-1",variant:"icon",tooltip:r(l)("files.Download"),onClick:e[6]||(e[6]=q(()=>{},["stop"]))},{default:y(()=>[s(x,{name:"download"})]),_:1},8,["tooltip"])],8,ht)):w("",!0),r(V)&&a.name!==".."?(f(),U(b,{key:3,tabindex:"-1",variant:"icon",tooltip:r(l)("files.Delete"),onClick:q(I=>ue(a),["stop"])},{default:y(()=>[s(x,{name:"remove"})]),_:2},1032,["tooltip","onClick"])):w("",!0)],40,yt))),128)):(f(),U(ae,{key:0}))],544),[[g,"f l"]]),s(A,{modelValue:E.value,"onUpdate:modelValue":e[9]||(e[9]=a=>E.value=a),closable:"",title:r(l)("files.OpenLargeFile")},{default:y(()=>[s(b,{color:"error",onClick:e[7]||(e[7]=a=>E.value=!1)},{default:y(()=>[s(x,{name:"close"}),N(h(r(l)("common.Cancel")),1)]),_:1}),s(b,{color:"primary",onClick:e[8]||(e[8]=a=>D(T.value,!0))},{default:y(()=>[s(x,{name:"check"}),N(h(r(l)("files.OpenAnyways")),1)]),_:1})]),_:1},8,["modelValue","title"]),s(A,{modelValue:p.value,"onUpdate:modelValue":e[12]||(e[12]=a=>p.value=a),closable:"",title:r(l)("files.CreateFile")},{default:y(()=>[s(ne,{modelValue:o.value,"onUpdate:modelValue":e[10]||(e[10]=a=>o.value=a)},null,8,["modelValue"]),s(b,{color:"primary",disabled:!o.value||o.value.trim()==="",onClick:e[11]||(e[11]=a=>fe())},{default:y(()=>[s(x,{name:"check"}),N(h(r(l)("files.CreateFile")),1)]),_:1},8,["disabled"])]),_:1},8,["modelValue","title"]),s(A,{modelValue:c.value,"onUpdate:modelValue":e[15]||(e[15]=a=>c.value=a),closable:"",title:r(l)("files.CreateFolder")},{default:y(()=>[s(ne,{modelValue:o.value,"onUpdate:modelValue":e[13]||(e[13]=a=>o.value=a)},null,8,["modelValue"]),s(b,{color:"primary",disabled:!o.value||o.value.trim()==="",onClick:e[14]||(e[14]=a=>me())},{default:y(()=>[s(x,{name:"check"}),N(h(r(l)("files.CreateFolder")),1)]),_:1},8,["disabled"])]),_:1},8,["modelValue","title"]),s(A,{modelValue:i.value,"onUpdate:modelValue":e[16]||(e[16]=a=>i.value=a),class:"loader-overlay"},{default:y(()=>[s(ae)]),_:1},8,["modelValue"]),s(A,{modelValue:k.value,"onUpdate:modelValue":e[20]||(e[20]=a=>k.value=a),class:"editor"},{default:y(()=>[B.value?(f(),U(We,{key:0,modelValue:B.value,"onUpdate:modelValue":e[17]||(e[17]=a=>B.value=a),"read-only":!r(V),onSave:e[18]||(e[18]=a=>se()),onClose:e[19]||(e[19]=a=>k.value=!1)},null,8,["modelValue","read-only"])):w("",!0)]),_:1},8,["modelValue"])])}}};export{bt as default};
//# sourceMappingURL=Files-3b0dd67f.js.map
